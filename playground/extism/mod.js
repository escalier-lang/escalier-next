var Je=Object.create;var Et=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty;var ve=(o,t,e)=>t in o?Et(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var qt=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var Qe=(o,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Pe(t))!Ue.call(o,i)&&i!==e&&Et(o,i,{get:()=>t[i],enumerable:!(s=Me(t,i))||s.enumerable});return o};var De=(o,t,e)=>(e=o!=null?Je(Ae(o)):{},Qe(t||!o||!o.__esModule?Et(e,"default",{value:o,enumerable:!0}):e,o));var te=(o,t,e)=>(ve(o,typeof t!="symbol"?t+"":t,e),e),_t=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var b=(o,t,e)=>(_t(o,t,"read from private field"),e?e.call(o):t.get(o)),V=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},W=(o,t,e,s)=>(_t(o,t,"write to private field"),s?s.call(o,e):t.set(o,e),e);var B=(o,t,e)=>(_t(o,t,"access private method"),e);var Ze=qt((mi,pe)=>{"use strict";pe.exports=be;function be(o,t,e){o instanceof RegExp&&(o=me(o,e)),t instanceof RegExp&&(t=me(t,e));var s=fe(o,t,e);return s&&{start:s[0],end:s[1],pre:e.slice(0,s[0]),body:e.slice(s[0]+o.length,s[1]),post:e.slice(s[1]+t.length)}}function me(o,t){var e=t.match(o);return e?e[0]:null}be.range=fe;function fe(o,t,e){var s,i,n,r,a,l=e.indexOf(o),c=e.indexOf(t,l+1),d=l;if(l>=0&&c>0){if(o===t)return[l,c];for(s=[],n=e.length;d>=0&&!a;)d==l?(s.push(d),l=e.indexOf(o,d+1)):s.length==1?a=[s.pop(),c]:(i=s.pop(),i<n&&(n=i,r=c),c=e.indexOf(t,d+1)),d=l<c&&l>=0?l:c;s.length&&(a=[n,r])}return a}});var Ve=qt((bi,xe)=>{var ye=Ze();xe.exports=ds;var Ge="\0SLASH"+Math.random()+"\0",Re="\0OPEN"+Math.random()+"\0",At="\0CLOSE"+Math.random()+"\0",Xe="\0COMMA"+Math.random()+"\0",ge="\0PERIOD"+Math.random()+"\0";function Pt(o){return parseInt(o,10)==o?parseInt(o,10):o.charCodeAt(0)}function as(o){return o.split("\\\\").join(Ge).split("\\{").join(Re).split("\\}").join(At).split("\\,").join(Xe).split("\\.").join(ge)}function cs(o){return o.split(Ge).join("\\").split(Re).join("{").split(At).join("}").split(Xe).join(",").split(ge).join(".")}function We(o){if(!o)return[""];var t=[],e=ye("{","}",o);if(!e)return o.split(",");var s=e.pre,i=e.body,n=e.post,r=s.split(",");r[r.length-1]+="{"+i+"}";var a=We(n);return n.length&&(r[r.length-1]+=a.shift(),r.push.apply(r,a)),t.push.apply(t,r),t}function ds(o){return o?(o.substr(0,2)==="{}"&&(o="\\{\\}"+o.substr(2)),ft(as(o),!0).map(cs)):[]}function us(o){return"{"+o+"}"}function hs(o){return/^-?0\d/.test(o)}function ms(o,t){return o<=t}function bs(o,t){return o>=t}function ft(o,t){var e=[],s=ye("{","}",o);if(!s)return[o];var i=s.pre,n=s.post.length?ft(s.post,!1):[""];if(/\$$/.test(s.pre))for(var r=0;r<n.length;r++){var a=i+"{"+s.body+"}"+n[r];e.push(a)}else{var l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),c=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),d=l||c,h=s.body.indexOf(",")>=0;if(!d&&!h)return s.post.match(/,.*\}/)?(o=s.pre+"{"+s.body+At+s.post,ft(o)):[o];var m;if(d)m=s.body.split(/\.\./);else if(m=We(s.body),m.length===1&&(m=ft(m[0],!1).map(us),m.length===1))return n.map(function(Be){return s.pre+m[0]+Be});var f;if(d){var p=Pt(m[0]),u=Pt(m[1]),y=Math.max(m[0].length,m[1].length),Z=m.length==3?Math.abs(Pt(m[2])):1,w=ms,F=u<p;F&&(Z*=-1,w=bs);var C=m.some(hs);f=[];for(var L=p;w(L,u);L+=Z){var E;if(c)E=String.fromCharCode(L),E==="\\"&&(E="");else if(E=String(L),C){var lt=y-E.length;if(lt>0){var $t=new Array(lt+1).join("0");L<0?E="-"+$t+E.slice(1):E=$t+E}}f.push(E)}}else{f=[];for(var $=0;$<m.length;$++)f.push.apply(f,ft(m[$],!1))}for(var $=0;$<f.length;$++)for(var r=0;r<n.length;r++){var a=i+f[$]+n[r];(!t||d||a)&&e.push(a)}}return e}});var J={allowSharedBufferCodec:!1,manifestSupportsPaths:!1,crossOriginChecksEnforced:!0,fsAccess:!1,hasWorkerCapability:typeof globalThis<"u"?globalThis.crossOriginIsolated&&typeof SharedArrayBuffer<"u":!0,supportsWasiPreview1:!0,extismStdoutEnvVarSet:!1};async function ee(o){throw new Error("readFile not supported in this environment")}async function Ct(o,t){if(String(o.headers.get("Content-Type")).split(";")[0]==="application/octet-stream"){let i=new Headers(o.headers);i.set("Content-Type","application/wasm"),o=new Response(o.body,{status:o.status,statusText:o.statusText,headers:i})}let e=t?await o.clone().arrayBuffer():void 0;return{module:await WebAssembly.compileStreaming(o),data:e}}async function Ft(o,t){if(o instanceof ArrayBuffer)return{wasm:[{data:new Uint8Array(o)}]};if(o instanceof WebAssembly.Module)return{wasm:[{module:o}]};if(typeof o=="string"){if(o.search(/^\s*\{/g)===0)return JSON.parse(o);if(o.search(/^(https?|file):\/\//)!==0)return{wasm:[{path:o}]};o=new URL(o)}if(o instanceof Response||o?.constructor?.name==="Response"){let s=o,i=s.headers.get("content-type")||"application/octet-stream";switch(i.split(";")[0]){case"application/octet-stream":case"application/wasm":return{wasm:[{response:s}]};case"application/json":case"text/json":return Ft(JSON.parse(await s.text()),t);default:throw new TypeError(`While processing manifest URL "${s.url}"; expected content-type of "text/json", "application/json", "application/octet-stream", or "application/wasm"; got "${i}" after stripping off charset.`)}}if(o instanceof URL)return Ft(await t(o,{redirect:"follow"}),t);if(!("wasm"in o))throw new TypeError('Expected "wasm" key in manifest');if(!Array.isArray(o.wasm))throw new TypeError('Expected "manifest.wasm" to be array');let e=o.wasm.findIndex(s=>!("data"in s)&&!("url"in s)&&!("path"in s)&&!("module"in s)&&!("response"in s));if(e>-1)throw new TypeError(`Expected every item in "manifest.wasm" to include either a "data", "url", or "path" key; got bad item at index ${e}`);return{...o}}async function je(o,t=fetch){let e=await Ft(o,t);return e.config??={},e}async function se(o,t){let e=[],s=await je(o,t),i=await Promise.all(s.wasm.map(async(n,r,a)=>{let l,c;if(n.data){let h=n.data;c=h.buffer?h.buffer:h,l=await WebAssembly.compile(h)}else if(n.path){let h=n.path,m=await ee(h);c=m.buffer,l=await WebAssembly.compile(m)}else if(n.url){let h=await t(n.url,{headers:{accept:"application/wasm;q=0.9,application/octet-stream;q=0.8","user-agent":"extism"}}),m=await Ct(h,Boolean(n.hash));c=m.data,l=m.module}else if(n.response){let h=await Ct(n.response,Boolean(n.hash));c=h.data,l=h.module}else if(n.module)e[r]=n.name??String(r),l=n.module;else throw new Error(`Unrecognized wasm item at index ${r}. Keys include: "${Object.keys(n).sort().join(",")}"`);let d=String(r);if(n.hash){if(!c)throw new Error("Item specified a hash but WebAssembly.Module source data is unavailable for hashing");let h=new Uint8Array(await crypto.subtle.digest("SHA-256",c)),m=new Uint8Array(32),f=!0;for(let u=0;u<32;++u)m[u]=parseInt(n.hash.slice(u<<1,(u<<1)+2),16),f=f&&m[u]===h[u];let p=()=>[...h].map(u=>u.toString(16).padStart(2,"0")).join("");if(!f)throw new Error(`Plugin error: hash mismatch. Expected: ${n.hash}. Actual: ${p()}`);d=p()}return e[r]=n.name??(r===a.length-1?"main":d),l}));if(!e.includes("main"))throw new Error('manifest with multiple modules must designate one "main" module');return[e,i]}var Rt,at,Yt=class extends DataView{constructor(e){super(e);V(this,at,null)}json(){return JSON.parse(this.string())}arrayBuffer(){return this.buffer}text(){return this.string()}string(){return b(Yt,Rt).decode(this.buffer)}bytes(){return b(this,at)??W(this,at,new Uint8Array(this.buffer)),b(this,at)}setInt8(e,s){throw new Error("Cannot set values on output")}setInt16(e,s,i){throw new Error("Cannot set values on output")}setInt32(e,s,i){throw new Error("Cannot set values on output")}setUint8(e,s){throw new Error("Cannot set values on output")}setUint16(e,s,i){throw new Error("Cannot set values on output")}setUint32(e,s,i){throw new Error("Cannot set values on output")}setFloat32(e,s,i){throw new Error("Cannot set values on output")}setFloat64(e,s,i){throw new Error("Cannot set values on output")}setBigInt64(e,s,i){throw new Error("Cannot set values on output")}setBigUint64(e,s,i){throw new Error("Cannot set values on output")}},H=Yt;Rt=new WeakMap,at=new WeakMap,V(H,Rt,new TextDecoder);var M=4;var kt=Symbol("begin"),Xt=Symbol("end"),Tt=Symbol("env"),ct=Symbol("get-block"),gt=Symbol("import-state"),Wt=Symbol("export-state"),q=Symbol("store-value"),dt=Symbol("reset"),R=class{get byteLength(){return this.buffer.byteLength}constructor(t,e){this.buffer=t,this.view=new DataView(this.buffer),this.local=e}static indexToAddress(t){return BigInt(t)<<48n}static addressToIndex(t){return Number(BigInt(t)>>48n)}static maskAddress(t){return Number(BigInt(t)&(1n<<48n)-1n)}},$e,nt=class{constructor(t,e,s){this.#t=[];this.#r=new Map;this[$e]={alloc:t=>this.alloc(t),free:t=>{this.#t[R.addressToIndex(t)]=null},load_u8:t=>{let e=R.addressToIndex(t),s=R.maskAddress(t);return this.#t[e]?.view.getUint8(Number(s))},load_u64:t=>{let e=R.addressToIndex(t),s=R.maskAddress(t);return this.#t[e]?.view.getBigUint64(Number(s),!0)},store_u8:(t,e)=>{let s=R.addressToIndex(t),i=R.maskAddress(t);this.#t[s]?.view.setUint8(Number(i),Number(e))},store_u64:(t,e)=>{let s=R.addressToIndex(t),i=R.maskAddress(t);this.#t[s]?.view.setBigUint64(Number(i),e,!0)},input_offset:()=>{let t=this.#e[this.#e.length-1][0];return R.indexToAddress(t||0)},input_length:()=>BigInt(this.#a?.byteLength??0),input_load_u8:t=>{let e=R.maskAddress(t);return this.#a?.view.getUint8(Number(e))},input_load_u64:t=>{let e=R.maskAddress(t);return this.#a?.view.getBigUint64(Number(e),!0)},output_set:(t,e)=>{let s=R.addressToIndex(t),i=this.#t[s];if(!i)throw new Error(`cannot assign to this block (addr=${t.toString(16).padStart(16,"0")}; length=${e})`);if(e>i.buffer.byteLength)throw new Error("length longer than target block");this.#e[this.#e.length-1][1]=s},error_set:t=>{let e=R.addressToIndex(t);if(!this.#t[e])throw new Error("cannot assign to this block");this.#e[this.#e.length-1][2]=e},config_get:t=>{let e=this.read(t);if(e===null)return 0n;let s=e.string();return s in this.#o?this.store(this.#o[s]):0n},var_get:t=>{let e=this.read(t);if(e===null)return 0n;let s=e.string();return this.#r.has(s)?R.indexToAddress(this.#r.get(s)):0n},var_set:(t,e)=>{let s=this.read(t);if(s===null)return 0n;let i=s.string();if(e===0n)return this.#r.delete(i),0n;this.#r.set(i,R.addressToIndex(e))},http_request:(t,e)=>(this.#s.error("http_request is not enabled"),0n),http_status_code:()=>(this.#s.error("http_status_code is not enabled"),0),length:t=>this.length(t),length_unsafe:t=>this.length(t),log_warn:t=>{let e=R.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(warn): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.warn(i)},log_info:t=>{let e=R.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(info): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.info(i)},log_debug:t=>{let e=R.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(debug): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.debug(i)},log_error:t=>{let e=R.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(error): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.error(i)}};this.#i=t,this.#s=e,this.#n=new TextDecoder,this.#l=new TextEncoder,this.#e=[],this.alloc(1),this.#o=s}#e;#t;#s;#n;#l;#i;#o;#r;alloc(t){let e=new R(new this.#i(Number(t)),!0),s=this.#t.length;return this.#t.push(e),R.indexToAddress(s)}getVariable(t){return this.#r.has(t)?this.read(this.#r.get(t)):null}setVariable(t,e){let s=this[q](e);if(s===null)return 0n;let i=this.#r.get(t)??null;return i!==null&&(this.#t[i]=this.#t[s],this.#t[s]=null,s===this.#t.length-1&&this.#t.pop()),this.#r.set(t,i??s),R.indexToAddress(i??s)}read(t){let e=R.addressToIndex(t),s=this.#t[e];if(!s)return null;let i=!(s.buffer instanceof ArrayBuffer)&&!J.allowSharedBufferCodec?new Uint8Array(s.buffer).slice().buffer:s.buffer;return new H(i)}store(t){let e=this[q](t);if(!e)throw new Error("failed to store output");return R.indexToAddress(e)}length(t){let e=R.addressToIndex(t),s=this.#t[e];return s?BigInt(s.buffer.byteLength):0n}get#a(){let t=this.#e[this.#e.length-1][0];return t===null?null:this.#t[t]}[($e=Tt,dt)](){this.#t.length=1,this.#e.length=0}[ct](t){let e=this.#t[t];if(!e)throw new Error(`invalid block index: ${t}`);return e}[gt](t,e=!1){for(let[s,i]of t.blocks){if(s&&e){let n=new Uint8Array(new this.#i(Number(s.byteLength)));n.set(new Uint8Array(s)),s=n.buffer}this.#t[i]=s?new R(s,!1):null}this.#e=t.stack}[Wt](){return{stack:this.#e.slice(),blocks:this.#t.map((t,e)=>t?t.local?(t.local=!1,[t.buffer,e]):null:[null,e]).filter(Boolean)}}[q](t){if(!t)return null;if(typeof t=="string"&&(t=this.#l.encode(t)),t instanceof Uint8Array){if(t.buffer.constructor===this.#i){let n=this.#t.length;return this.#t.push(new R(t.buffer,!0)),n}let e=R.addressToIndex(this.alloc(t.length)),s=this.#t[e];return new Uint8Array(s.buffer).set(t,0),e}return t}[kt](t){this.#e.push([t,null,null])}[Xt](){let[,t,e]=this.#e.pop(),s=e===null?1:0,i=e??t,n=[null,null];return i===null||this.#t[i]===null||(n[s]=i),n}};var P=class{static read_bytes(t,e){let s=new P;return s.buf=t.getUint32(e,!0),s.buf_len=t.getUint32(e+4,!0),s}static read_bytes_array(t,e,s){let i=[];for(let n=0;n<s;n++)i.push(P.read_bytes(t,e+8*n));return i}},A=class{static read_bytes(t,e){let s=new A;return s.buf=t.getUint32(e,!0),s.buf_len=t.getUint32(e+4,!0),s}static read_bytes_array(t,e,s){let i=[];for(let n=0;n<s;n++)i.push(A.read_bytes(t,e+8*n));return i}},ne=0,ie=1,Ht=2;var Ot=2;var Kt=4;var re=1<<0,mn=1<<1,bn=1<<2,fn=1<<3,pn=1<<4,ut=class{write_bytes(t,e){t.setUint8(e,this.fs_filetype),t.setUint16(e+2,this.fs_flags,!0),t.setBigUint64(e+8,this.fs_rights_base,!0),t.setBigUint64(e+16,this.fs_rights_inherited,!0)}constructor(t,e){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=t,this.fs_flags=e}},Zn=1<<0,yn=1<<1,Gn=1<<2,Rn=1<<3,qe=1<<0,ts=1<<1,es=1<<2,ss=1<<3,ht=class{write_bytes(t,e){t.setBigUint64(e,this.dev,!0),t.setBigUint64(e+8,this.ino,!0),t.setUint8(e+16,this.filetype),t.setBigUint64(e+24,this.nlink,!0),t.setBigUint64(e+32,this.size,!0),t.setBigUint64(e+38,this.atim,!0),t.setBigUint64(e+46,this.mtim,!0),t.setBigUint64(e+52,this.ctim,!0)}constructor(t,e){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=t,this.size=e}};var Xn=1<<0,gn=1<<0;var Wn=1<<0,xn=1<<1,Vn=1<<0,In=1<<0,wn=1<<1;var ns=class{enable(t){this.log=is(t===void 0?!0:t,this.prefix)}get enabled(){return this.isEnabled}constructor(t){this.isEnabled=t,this.prefix="wasi:",this.enable(t)}};function is(o,t){return o?console.log.bind(console,"%c%s","color: #265BA0",t):()=>{}}var T=new ns(!1);var Vt=class extends Error{constructor(t){super("exit with exit code "+t),this.code=t}},Bt=class{start(t){this.inst=t;try{return t.exports._start(),0}catch(e){if(e instanceof Vt)return e.code;throw e}}initialize(t){this.inst=t,t.exports._initialize&&t.exports._initialize()}constructor(t,e,s,i={}){this.args=[],this.env=[],this.fds=[],T.enable(i.debug),this.args=t,this.env=e,this.fds=s;let n=this;this.wasiImport={args_sizes_get(r,a){let l=new DataView(n.inst.exports.memory.buffer);l.setUint32(r,n.args.length,!0);let c=0;for(let d of n.args)c+=d.length+1;return l.setUint32(a,c,!0),T.log(l.getUint32(r,!0),l.getUint32(a,!0)),0},args_get(r,a){let l=new DataView(n.inst.exports.memory.buffer),c=new Uint8Array(n.inst.exports.memory.buffer),d=a;for(let h=0;h<n.args.length;h++){l.setUint32(r,a,!0),r+=4;let m=new TextEncoder().encode(n.args[h]);c.set(m,a),l.setUint8(a+m.length,0),a+=m.length+1}return T.enabled&&T.log(new TextDecoder("utf-8").decode(c.slice(d,a))),0},environ_sizes_get(r,a){let l=new DataView(n.inst.exports.memory.buffer);l.setUint32(r,n.env.length,!0);let c=0;for(let d of n.env)c+=d.length+1;return l.setUint32(a,c,!0),T.log(l.getUint32(r,!0),l.getUint32(a,!0)),0},environ_get(r,a){let l=new DataView(n.inst.exports.memory.buffer),c=new Uint8Array(n.inst.exports.memory.buffer),d=a;for(let h=0;h<n.env.length;h++){l.setUint32(r,a,!0),r+=4;let m=new TextEncoder().encode(n.env[h]);c.set(m,a),l.setUint8(a+m.length,0),a+=m.length+1}return T.enabled&&T.log(new TextDecoder("utf-8").decode(c.slice(d,a))),0},clock_res_get(r,a){let l;switch(r){case 1:{l=5000n;break}case 0:{l=1000000n;break}default:return 52}return new DataView(n.inst.exports.memory.buffer).setBigUint64(a,l,!0),0},clock_time_get(r,a,l){let c=new DataView(n.inst.exports.memory.buffer);if(r===0)c.setBigUint64(l,BigInt(new Date().getTime())*1000000n,!0);else if(r==1){let d;try{d=BigInt(Math.round(performance.now()*1e6))}catch{d=0n}c.setBigUint64(l,d,!0)}else c.setBigUint64(l,0n,!0);return 0},fd_advise(r,a,l,c){return n.fds[r]!=null?n.fds[r].fd_advise(a,l,c):8},fd_allocate(r,a,l){return n.fds[r]!=null?n.fds[r].fd_allocate(a,l):8},fd_close(r){if(n.fds[r]!=null){let a=n.fds[r].fd_close();return n.fds[r]=void 0,a}else return 8},fd_datasync(r){return n.fds[r]!=null?n.fds[r].fd_datasync():8},fd_fdstat_get(r,a){if(n.fds[r]!=null){let{ret:l,fdstat:c}=n.fds[r].fd_fdstat_get();return c?.write_bytes(new DataView(n.inst.exports.memory.buffer),a),l}else return 8},fd_fdstat_set_flags(r,a){return n.fds[r]!=null?n.fds[r].fd_fdstat_set_flags(a):8},fd_fdstat_set_rights(r,a,l){return n.fds[r]!=null?n.fds[r].fd_fdstat_set_rights(a,l):8},fd_filestat_get(r,a){if(n.fds[r]!=null){let{ret:l,filestat:c}=n.fds[r].fd_filestat_get();return c?.write_bytes(new DataView(n.inst.exports.memory.buffer),a),l}else return 8},fd_filestat_set_size(r,a){return n.fds[r]!=null?n.fds[r].fd_filestat_set_size(a):8},fd_filestat_set_times(r,a,l,c){return n.fds[r]!=null?n.fds[r].fd_filestat_set_times(a,l,c):8},fd_pread(r,a,l,c,d){let h=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let f=P.read_bytes_array(h,a,l),{ret:p,nread:u}=n.fds[r].fd_pread(m,f,c);return h.setUint32(d,u,!0),p}else return 8},fd_prestat_get(r,a){let l=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:c,prestat:d}=n.fds[r].fd_prestat_get();return d?.write_bytes(l,a),c}else return 8},fd_prestat_dir_name(r,a,l){if(n.fds[r]!=null){let{ret:c,prestat_dir_name:d}=n.fds[r].fd_prestat_dir_name();return d!=null&&new Uint8Array(n.inst.exports.memory.buffer).set(d,a),c}else return 8},fd_pwrite(r,a,l,c,d){let h=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let f=A.read_bytes_array(h,a,l),{ret:p,nwritten:u}=n.fds[r].fd_pwrite(m,f,c);return h.setUint32(d,u,!0),p}else return 8},fd_read(r,a,l,c){let d=new DataView(n.inst.exports.memory.buffer),h=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let m=P.read_bytes_array(d,a,l),{ret:f,nread:p}=n.fds[r].fd_read(h,m);return d.setUint32(c,p,!0),f}else return 8},fd_readdir(r,a,l,c,d){let h=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let f=0;for(;;){let{ret:p,dirent:u}=n.fds[r].fd_readdir_single(c);if(p!=0)return h.setUint32(d,f,!0),p;if(u==null)break;if(l-f<u.head_length()){f=l;break}let y=new ArrayBuffer(u.head_length());if(u.write_head_bytes(new DataView(y),0),m.set(new Uint8Array(y).slice(0,Math.min(y.byteLength,l-f)),a),a+=u.head_length(),f+=u.head_length(),l-f<u.name_length()){f=l;break}u.write_name_bytes(m,a,l-f),a+=u.name_length(),f+=u.name_length(),c=u.d_next}return h.setUint32(d,f,!0),0}else return 8},fd_renumber(r,a){if(n.fds[r]!=null&&n.fds[a]!=null){let l=n.fds[a].fd_close();return l!=0?l:(n.fds[a]=n.fds[r],n.fds[r]=void 0,0)}else return 8},fd_seek(r,a,l,c){let d=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:h,offset:m}=n.fds[r].fd_seek(a,l);return d.setBigInt64(c,m,!0),h}else return 8},fd_sync(r){return n.fds[r]!=null?n.fds[r].fd_sync():8},fd_tell(r,a){let l=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:c,offset:d}=n.fds[r].fd_tell();return l.setBigUint64(a,d,!0),c}else return 8},fd_write(r,a,l,c){let d=new DataView(n.inst.exports.memory.buffer),h=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let m=A.read_bytes_array(d,a,l),{ret:f,nwritten:p}=n.fds[r].fd_write(h,m);return d.setUint32(c,p,!0),f}else return 8},path_create_directory(r,a,l){let c=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=new TextDecoder("utf-8").decode(c.slice(a,a+l));return n.fds[r].path_create_directory(d)}},path_filestat_get(r,a,l,c,d){let h=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let f=new TextDecoder("utf-8").decode(m.slice(l,l+c)),{ret:p,filestat:u}=n.fds[r].path_filestat_get(a,f);return u?.write_bytes(h,d),p}else return 8},path_filestat_set_times(r,a,l,c,d,h,m){let f=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let p=new TextDecoder("utf-8").decode(f.slice(l,l+c));return n.fds[r].path_filestat_set_times(a,p,d,h,m)}else return 8},path_link(r,a,l,c,d,h,m){let f=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null&&n.fds[d]!=null){let p=new TextDecoder("utf-8").decode(f.slice(l,l+c)),u=new TextDecoder("utf-8").decode(f.slice(h,h+m));return n.fds[d].path_link(r,a,p,u)}else return 8},path_open(r,a,l,c,d,h,m,f,p){let u=new DataView(n.inst.exports.memory.buffer),y=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let Z=new TextDecoder("utf-8").decode(y.slice(l,l+c));T.log(Z);let{ret:w,fd_obj:F}=n.fds[r].path_open(a,Z,d,h,m,f);if(w!=0)return w;n.fds.push(F);let C=n.fds.length-1;return u.setUint32(p,C,!0),0}else return 8},path_readlink(r,a,l,c,d,h){let m=new DataView(n.inst.exports.memory.buffer),f=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let p=new TextDecoder("utf-8").decode(f.slice(a,a+l));T.log(p);let{ret:u,data:y}=n.fds[r].path_readlink(p);if(y!=null){let Z=new TextEncoder().encode(y);if(Z.length>d)return m.setUint32(h,0,!0),8;f.set(Z,c),m.setUint32(h,Z.length,!0)}return u}else return 8},path_remove_directory(r,a,l){let c=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=new TextDecoder("utf-8").decode(c.slice(a,a+l));return n.fds[r].path_remove_directory(d)}else return 8},path_rename(r,a,l,c,d,h){throw"FIXME what is the best abstraction for this?"},path_symlink(r,a,l,c,d){let h=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[l]!=null){let m=new TextDecoder("utf-8").decode(h.slice(r,r+a)),f=new TextDecoder("utf-8").decode(h.slice(c,c+d));return n.fds[l].path_symlink(m,f)}else return 8},path_unlink_file(r,a,l){let c=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=new TextDecoder("utf-8").decode(c.slice(a,a+l));return n.fds[r].path_unlink_file(d)}else return 8},poll_oneoff(r,a,l){throw"async io not supported"},proc_exit(r){throw new Vt(r)},proc_raise(r){throw"raised signal "+r},sched_yield(){},random_get(r,a){let l=new Uint8Array(n.inst.exports.memory.buffer);for(let c=0;c<a;c++)l[r+c]=Math.random()*256|0},sock_recv(r,a,l){throw"sockets not supported"},sock_send(r,a,l){throw"sockets not supported"},sock_shutdown(r,a){throw"sockets not supported"},sock_accept(r,a){throw"sockets not supported"}}}};var it=class{fd_advise(t,e,s){return 58}fd_allocate(t,e){return 58}fd_close(){return 0}fd_datasync(){return 58}fd_fdstat_get(){return{ret:58,fdstat:null}}fd_fdstat_set_flags(t){return 58}fd_fdstat_set_rights(t,e){return 58}fd_filestat_get(){return{ret:58,filestat:null}}fd_filestat_set_size(t){return 58}fd_filestat_set_times(t,e,s){return 58}fd_pread(t,e,s){return{ret:58,nread:0}}fd_prestat_get(){return{ret:58,prestat:null}}fd_prestat_dir_name(){return{ret:58,prestat_dir_name:null}}fd_pwrite(t,e,s){return{ret:58,nwritten:0}}fd_read(t,e){return{ret:58,nread:0}}fd_readdir_single(t){return{ret:58,dirent:null}}fd_seek(t,e){return{ret:58,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:58,offset:0n}}fd_write(t,e){return{ret:58,nwritten:0}}path_create_directory(t){return 58}path_filestat_get(t,e){return{ret:58,filestat:null}}path_filestat_set_times(t,e,s,i,n){return 58}path_link(t,e,s,i){return 58}path_open(t,e,s,i,n,r){return{ret:58,fd_obj:null}}path_readlink(t){return{ret:58,data:null}}path_remove_directory(t){return 58}path_rename(t,e,s){return 58}path_symlink(t,e){return 58}path_unlink_file(t){return 58}};var U=class extends it{fd_fdstat_get(){return{ret:0,fdstat:new ut(Kt,0)}}fd_read(t,e){let s=0;for(let i of e)if(this.file_pos<this.file.data.byteLength){let n=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(i.buf_len)));t.set(n,i.buf),this.file_pos+=BigInt(n.length),s+=n.length}else break;return{ret:0,nread:s}}fd_pread(t,e,s){let i=0;for(let n of e)if(s<this.file.data.byteLength){let r=this.file.data.slice(Number(s),Number(s+BigInt(n.buf_len)));t.set(r,n.buf),s+=BigInt(r.length),i+=r.length}else break;return{ret:0,nread:i}}fd_seek(t,e){let s;switch(e){case ne:s=t;break;case ie:s=this.file_pos+t;break;case Ht:s=BigInt(this.file.data.byteLength)+t;break;default:return{ret:28,offset:0n}}return s<0?{ret:28,offset:0n}:(this.file_pos=s,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(t,e){let s=0;if(this.file.readonly)return{ret:8,nwritten:s};for(let i of e){let n=t.slice(i.buf,i.buf+i.buf_len);if(this.file_pos+BigInt(n.byteLength)>this.file.size){let r=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(n.byteLength))),this.file.data.set(r)}this.file.data.set(n.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(n.byteLength),s+=i.buf_len}return{ret:0,nwritten:s}}fd_pwrite(t,e,s){let i=0;if(this.file.readonly)return{ret:8,nwritten:i};for(let n of e){let r=t.slice(n.buf,n.buf+n.buf_len);if(s+BigInt(r.byteLength)>this.file.size){let a=this.file.data;this.file.data=new Uint8Array(Number(s+BigInt(r.byteLength))),this.file.data.set(a)}this.file.data.set(r.slice(0,Number(this.file.size-s)),Number(s)),s+=BigInt(r.byteLength),i+=n.buf_len}return{ret:0,nwritten:i}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(t){super(),this.file_pos=0n,this.file=t}};var tt=class{open(t){let e=new U(this);return t&re&&e.fd_seek(0n,Ht),e}get size(){return BigInt(this.data.byteLength)}stat(){return new ht(Kt,this.size)}truncate(){return this.readonly?63:(this.data=new Uint8Array([]),0)}constructor(t,e){this.data=new Uint8Array(t),this.readonly=!!e?.readonly}};var O=class extends it{fd_filestat_get(){return{ret:0,filestat:new ht(Ot,BigInt(0))}}fd_fdstat_get(){let t=new ut(Ot,0);return t.fs_rights_base=BigInt(64),{ret:0,fdstat:t}}fd_write(t,e){let s=0;for(let i of e){let n=t.slice(i.buf,i.buf+i.buf_len);this.write(n),s+=i.buf_len}return{ret:0,nwritten:s}}static lineBuffered(t){let e=new TextDecoder("utf-8",{fatal:!1}),s="";return new O(i=>{s+=e.decode(i,{stream:!0});let n=s.split(`
`);for(let[r,a]of n.entries())r<n.length-1?t(a):s=a})}constructor(t){super(),this.write=t}};async function ce(o,t,e){console.log("fileDescriptors = ",e);let s=[],i=[],n=t?[O.lineBuffered(a=>console.log(a)),O.lineBuffered(a=>console.log(a)),O.lineBuffered(a=>console.warn(a)),...e]:[new U(new tt([])),new U(new tt([])),new U(new tt([])),...e],r=new Bt(s,i,n,{debug:!1});return{async importObject(){return r.wasiImport},async close(){},async initialize(a){let l=a.exports.memory;if(!l)throw new Error("The module has to export a default memory.");if(a.exports._initialize){let c=a.exports._initialize;r.initialize?r.initialize({exports:{memory:l,_initialize:()=>{c()}}}):c()}else r.start({exports:{memory:l,_start:()=>{}}})}}}var mt="extism:host/env",Jt=class{#e;#t;#s=!1;#n;constructor(t,e,s){this.#e=t,this.#t=e,this.#n=s}async reset(){return this.isActive()?!1:(this.#e[dt](),!0)}isActive(){return this.#s}async functionExists(t){return typeof this.#t[1].exports[t]=="function"}async callBlock(t,e){this.#s=!0;let s=this.#t[1].exports[t];if(!s)throw Error(`Plugin error: function "${t}" does not exist`);if(typeof s!="function")throw Error(`Plugin error: export "${t}" is not a function`);this.#e[kt](e??null);try{return s(),this.#e[Xt]()}catch(i){throw this.#e[Xt](),i}finally{this.#s=!1}}async call(t,e){let s=this.#e[q](e),[i,n]=await this.callBlock(t,s),r=i!==null,a=i??n;if(a===null)return null;let l=this.#e[ct](a);if(!l)return null;let c=new H(l.buffer);if(r)throw new Error(`Plugin-originated error: ${c.string()}`);return c}async getExports(){return WebAssembly.Module.exports(this.#t[0])||[]}async getImports(){return WebAssembly.Module.imports(this.#t[0])||[]}async getInstance(){return this.#t[1]}async close(){await Promise.all(this.#n.map(t=>t.close())),this.#n.length=0}};async function de(o,t,e,s=new nt(ArrayBuffer,o.logger,o.config)){let i={[mt]:s[Tt],env:{}};for(let c in o.functions){i[c]=i[c]||{};for(let d in o.functions[c])i[c][d]=o.functions[c][d].bind(null,s)}let n=t.indexOf("main");if(n===-1)throw new Error('Unreachable: manifests must have at least one "main" module. Enforced by "src/manifest.ts")');let r=new Map,a=[],l=await Mt(["main"],e[n],i,o,a,t,e,r);return new Jt(s,[e[n],l],a)}async function Mt(o,t,e,s,i,n,r,a){a.set(t,null);let l={},c=WebAssembly.Module.imports(t),d=null;for(let{kind:f,module:p,name:u}of c){let y=n.indexOf(p);if(y===-1){if(p==="wasi_snapshot_preview1"&&d===null){if(!s.wasiEnabled)throw new Error('WASI is not enabled; see the "wasiEnabled" plugin option');d===null&&(d=await ce(s.allowedPaths,s.enableWasiOutput,s.fileDescriptors),i.push(d),e.wasi_snapshot_preview1=await d.importObject())}if(!Object.hasOwnProperty.call(e,p))throw new Error(`from module "${o.join('"/"')}": cannot resolve import "${p}" "${u}": not provided by host imports nor linked manifest items`);if(!Object.hasOwnProperty.call(e[p],u))throw new Error(`from module "${o.join('"/"')}": cannot resolve import "${p}" "${u}" ("${p}" is a host module, but does not contain "${u}")`);switch(f){case"function":{l[p]??={},l[p][u]=e[p][u];break}default:throw new Error(`from module "${o.join('"/"')}": in import "${p}" "${u}", "${f}"-typed host imports are not supported yet`)}}else{let Z=r[y],w=WebAssembly.Module.exports(Z);if(!w.find(L=>L.name===u&&L.kind===f))throw new Error(`from module "${o.join('"/"')}": cannot import "${p}" "${u}"; no export matched request`);let C=w.find(L=>L.name==="_start")?await Mt([...o,p],Z,e,s,i,n,r,new Map):(a.has(Z)||await Mt([...o,p],Z,e,s,i,n,r,a),a.get(Z));if(C)l[p]??={},l[p][u]=C.exports[u];else if(f==="function"){l[p]={};let L=null;l[p][u]=(...E)=>{if(L)return L(...E);let lt=a.get(r[y]);if(!lt)throw new Error(`from module instance "${o.join('"/"')}": target module "${p}" was never instantiated`);return L=lt.exports[u],L(...E)}}else throw new Error(`from module "${o.join('"/"')}": cannot import "${p}" "${u}"; circular imports of type="${f}" are not supported`)}}let h=await WebAssembly.instantiate(t,l),m=h.exports.hs_init?"haskell":h.exports._initialize?"reactor":h.exports._start?"command":"none";if(d)await d?.initialize(h),h.exports.hs_init&&h.exports.hs_init();else switch(m){case"command":h.exports._initialize&&h.exports._initialize(),h.exports._start();break;case"reactor":h.exports._initialize();break;case"haskell":h.exports.hs_init();break}return a.set(t,h),h}var ue=new URL("data:text/javascript;base64,dmFyIHV0PSh1LHQsZSk9PntpZighdC5oYXModSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitlKX07dmFyIEM9KHUsdCxlKT0+KHV0KHUsdCwicmVhZCBmcm9tIHByaXZhdGUgZmllbGQiKSxlP2UuY2FsbCh1KTp0LmdldCh1KSksUD0odSx0LGUpPT57aWYodC5oYXModSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgYWRkIHRoZSBzYW1lIHByaXZhdGUgbWVtYmVyIG1vcmUgdGhhbiBvbmNlIik7dCBpbnN0YW5jZW9mIFdlYWtTZXQ/dC5hZGQodSk6dC5zZXQodSxlKX0saz0odSx0LGUscik9Pih1dCh1LHQsIndyaXRlIHRvIHByaXZhdGUgZmllbGQiKSxyP3IuY2FsbCh1LGUpOnQuc2V0KHUsZSksZSk7dmFyIGR0PXtvbih1LHQpe2FkZEV2ZW50TGlzdGVuZXIodSxlPT57dChlLmRhdGEpfSl9LHBvc3RNZXNzYWdlKHUsdD1bXSl7c2VsZi5wb3N0TWVzc2FnZSh1LHQpfX07dmFyIEgsQixYPWNsYXNzIGV4dGVuZHMgRGF0YVZpZXd7Y29uc3RydWN0b3IoZSl7c3VwZXIoZSk7UCh0aGlzLEIsbnVsbCl9anNvbigpe3JldHVybiBKU09OLnBhcnNlKHRoaXMuc3RyaW5nKCkpfWFycmF5QnVmZmVyKCl7cmV0dXJuIHRoaXMuYnVmZmVyfXRleHQoKXtyZXR1cm4gdGhpcy5zdHJpbmcoKX1zdHJpbmcoKXtyZXR1cm4gQyhYLEgpLmRlY29kZSh0aGlzLmJ1ZmZlcil9Ynl0ZXMoKXtyZXR1cm4gQyh0aGlzLEIpPz9rKHRoaXMsQixuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlcikpLEModGhpcyxCKX1zZXRJbnQ4KGUscil7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRJbnQxNihlLHIsYSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRJbnQzMihlLHIsYSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRVaW50OChlLHIpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0VWludDE2KGUscixhKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldFVpbnQzMihlLHIsYSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRGbG9hdDMyKGUscixhKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldEZsb2F0NjQoZSxyLGEpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0QmlnSW50NjQoZSxyLGEpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0QmlnVWludDY0KGUscixhKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfX0sVD1YO0g9bmV3IFdlYWtNYXAsQj1uZXcgV2Vha01hcCxQKFQsSCxuZXcgVGV4dERlY29kZXIpO3ZhciB4PTQ7dmFyIF90PXthbGxvd1NoYXJlZEJ1ZmZlckNvZGVjOiExLG1hbmlmZXN0U3VwcG9ydHNQYXRoczohMSxjcm9zc09yaWdpbkNoZWNrc0VuZm9yY2VkOiEwLGZzQWNjZXNzOiExLGhhc1dvcmtlckNhcGFiaWxpdHk6dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXMuY3Jvc3NPcmlnaW5Jc29sYXRlZCYmdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyPCJ1IjohMCxzdXBwb3J0c1dhc2lQcmV2aWV3MTohMCxleHRpc21TdGRvdXRFbnZWYXJTZXQ6ITF9O3ZhciBxPVN5bWJvbCgiYmVnaW4iKSxWPVN5bWJvbCgiZW5kIiksUT1TeW1ib2woImVudiIpLFo9U3ltYm9sKCJnZXQtYmxvY2siKSxZPVN5bWJvbCgiaW1wb3J0LXN0YXRlIiksej1TeW1ib2woImV4cG9ydC1zdGF0ZSIpLEc9U3ltYm9sKCJzdG9yZS12YWx1ZSIpLEo9U3ltYm9sKCJyZXNldCIpLEU9Y2xhc3N7Z2V0IGJ5dGVMZW5ndGgoKXtyZXR1cm4gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aH1jb25zdHJ1Y3Rvcih0LGUpe3RoaXMuYnVmZmVyPXQsdGhpcy52aWV3PW5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciksdGhpcy5sb2NhbD1lfXN0YXRpYyBpbmRleFRvQWRkcmVzcyh0KXtyZXR1cm4gQmlnSW50KHQpPDw0OG59c3RhdGljIGFkZHJlc3NUb0luZGV4KHQpe3JldHVybiBOdW1iZXIoQmlnSW50KHQpPj40OG4pfXN0YXRpYyBtYXNrQWRkcmVzcyh0KXtyZXR1cm4gTnVtYmVyKEJpZ0ludCh0KSYoMW48PDQ4biktMW4pfX0seHQsRD1jbGFzc3tjb25zdHJ1Y3Rvcih0LGUscil7dGhpcy4jdD1bXTt0aGlzLiNyPW5ldyBNYXA7dGhpc1t4dF09e2FsbG9jOnQ9PnRoaXMuYWxsb2ModCksZnJlZTp0PT57dGhpcy4jdFtFLmFkZHJlc3NUb0luZGV4KHQpXT1udWxsfSxsb2FkX3U4OnQ9PntsZXQgZT1FLmFkZHJlc3NUb0luZGV4KHQpLHI9RS5tYXNrQWRkcmVzcyh0KTtyZXR1cm4gdGhpcy4jdFtlXT8udmlldy5nZXRVaW50OChOdW1iZXIocikpfSxsb2FkX3U2NDp0PT57bGV0IGU9RS5hZGRyZXNzVG9JbmRleCh0KSxyPUUubWFza0FkZHJlc3ModCk7cmV0dXJuIHRoaXMuI3RbZV0/LnZpZXcuZ2V0QmlnVWludDY0KE51bWJlcihyKSwhMCl9LHN0b3JlX3U4Oih0LGUpPT57bGV0IHI9RS5hZGRyZXNzVG9JbmRleCh0KSxhPUUubWFza0FkZHJlc3ModCk7dGhpcy4jdFtyXT8udmlldy5zZXRVaW50OChOdW1iZXIoYSksTnVtYmVyKGUpKX0sc3RvcmVfdTY0Oih0LGUpPT57bGV0IHI9RS5hZGRyZXNzVG9JbmRleCh0KSxhPUUubWFza0FkZHJlc3ModCk7dGhpcy4jdFtyXT8udmlldy5zZXRCaWdVaW50NjQoTnVtYmVyKGEpLGUsITApfSxpbnB1dF9vZmZzZXQ6KCk9PntsZXQgdD10aGlzLiNlW3RoaXMuI2UubGVuZ3RoLTFdWzBdO3JldHVybiBFLmluZGV4VG9BZGRyZXNzKHR8fDApfSxpbnB1dF9sZW5ndGg6KCk9PkJpZ0ludCh0aGlzLiNhPy5ieXRlTGVuZ3RoPz8wKSxpbnB1dF9sb2FkX3U4OnQ9PntsZXQgZT1FLm1hc2tBZGRyZXNzKHQpO3JldHVybiB0aGlzLiNhPy52aWV3LmdldFVpbnQ4KE51bWJlcihlKSl9LGlucHV0X2xvYWRfdTY0OnQ9PntsZXQgZT1FLm1hc2tBZGRyZXNzKHQpO3JldHVybiB0aGlzLiNhPy52aWV3LmdldEJpZ1VpbnQ2NChOdW1iZXIoZSksITApfSxvdXRwdXRfc2V0Oih0LGUpPT57bGV0IHI9RS5hZGRyZXNzVG9JbmRleCh0KSxhPXRoaXMuI3Rbcl07aWYoIWEpdGhyb3cgbmV3IEVycm9yKGBjYW5ub3QgYXNzaWduIHRvIHRoaXMgYmxvY2sgKGFkZHI9JHt0LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgxNiwiMCIpfTsgbGVuZ3RoPSR7ZX0pYCk7aWYoZT5hLmJ1ZmZlci5ieXRlTGVuZ3RoKXRocm93IG5ldyBFcnJvcigibGVuZ3RoIGxvbmdlciB0aGFuIHRhcmdldCBibG9jayIpO3RoaXMuI2VbdGhpcy4jZS5sZW5ndGgtMV1bMV09cn0sZXJyb3Jfc2V0OnQ9PntsZXQgZT1FLmFkZHJlc3NUb0luZGV4KHQpO2lmKCF0aGlzLiN0W2VdKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGFzc2lnbiB0byB0aGlzIGJsb2NrIik7dGhpcy4jZVt0aGlzLiNlLmxlbmd0aC0xXVsyXT1lfSxjb25maWdfZ2V0OnQ9PntsZXQgZT10aGlzLnJlYWQodCk7aWYoZT09PW51bGwpcmV0dXJuIDBuO2xldCByPWUuc3RyaW5nKCk7cmV0dXJuIHIgaW4gdGhpcy4jbz90aGlzLnN0b3JlKHRoaXMuI29bcl0pOjBufSx2YXJfZ2V0OnQ9PntsZXQgZT10aGlzLnJlYWQodCk7aWYoZT09PW51bGwpcmV0dXJuIDBuO2xldCByPWUuc3RyaW5nKCk7cmV0dXJuIHRoaXMuI3IuaGFzKHIpP0UuaW5kZXhUb0FkZHJlc3ModGhpcy4jci5nZXQocikpOjBufSx2YXJfc2V0Oih0LGUpPT57bGV0IHI9dGhpcy5yZWFkKHQpO2lmKHI9PT1udWxsKXJldHVybiAwbjtsZXQgYT1yLnN0cmluZygpO2lmKGU9PT0wbilyZXR1cm4gdGhpcy4jci5kZWxldGUoYSksMG47dGhpcy4jci5zZXQoYSxFLmFkZHJlc3NUb0luZGV4KGUpKX0saHR0cF9yZXF1ZXN0Oih0LGUpPT4odGhpcy4jbi5lcnJvcigiaHR0cF9yZXF1ZXN0IGlzIG5vdCBlbmFibGVkIiksMG4pLGh0dHBfc3RhdHVzX2NvZGU6KCk9Pih0aGlzLiNuLmVycm9yKCJodHRwX3N0YXR1c19jb2RlIGlzIG5vdCBlbmFibGVkIiksMCksbGVuZ3RoOnQ9PnRoaXMubGVuZ3RoKHQpLGxlbmd0aF91bnNhZmU6dD0+dGhpcy5sZW5ndGgodCksbG9nX3dhcm46dD0+e2xldCBlPUUuYWRkcmVzc1RvSW5kZXgodCkscj10aGlzLiN0W2VdO2lmKCFyKXJldHVybiB0aGlzLiNuLmVycm9yKGBmYWlsZWQgdG8gbG9nKHdhcm4pOiBiYWQgYmxvY2sgcmVmZXJlbmNlIGluIGFkZHIgMHgke3QudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDY0LCIwIil9YCk7bGV0IGE9dGhpcy4jcy5kZWNvZGUoci5idWZmZXIpO3RoaXMuI24ud2FybihhKX0sbG9nX2luZm86dD0+e2xldCBlPUUuYWRkcmVzc1RvSW5kZXgodCkscj10aGlzLiN0W2VdO2lmKCFyKXJldHVybiB0aGlzLiNuLmVycm9yKGBmYWlsZWQgdG8gbG9nKGluZm8pOiBiYWQgYmxvY2sgcmVmZXJlbmNlIGluIGFkZHIgMHgke3QudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDY0LCIwIil9YCk7bGV0IGE9dGhpcy4jcy5kZWNvZGUoci5idWZmZXIpO3RoaXMuI24uaW5mbyhhKX0sbG9nX2RlYnVnOnQ9PntsZXQgZT1FLmFkZHJlc3NUb0luZGV4KHQpLHI9dGhpcy4jdFtlXTtpZighcilyZXR1cm4gdGhpcy4jbi5lcnJvcihgZmFpbGVkIHRvIGxvZyhkZWJ1Zyk6IGJhZCBibG9jayByZWZlcmVuY2UgaW4gYWRkciAweCR7dC50b1N0cmluZygxNikucGFkU3RhcnQoNjQsIjAiKX1gKTtsZXQgYT10aGlzLiNzLmRlY29kZShyLmJ1ZmZlcik7dGhpcy4jbi5kZWJ1ZyhhKX0sbG9nX2Vycm9yOnQ9PntsZXQgZT1FLmFkZHJlc3NUb0luZGV4KHQpLHI9dGhpcy4jdFtlXTtpZighcilyZXR1cm4gdGhpcy4jbi5lcnJvcihgZmFpbGVkIHRvIGxvZyhlcnJvcik6IGJhZCBibG9jayByZWZlcmVuY2UgaW4gYWRkciAweCR7dC50b1N0cmluZygxNikucGFkU3RhcnQoNjQsIjAiKX1gKTtsZXQgYT10aGlzLiNzLmRlY29kZShyLmJ1ZmZlcik7dGhpcy4jbi5lcnJvcihhKX19O3RoaXMuI2k9dCx0aGlzLiNuPWUsdGhpcy4jcz1uZXcgVGV4dERlY29kZXIsdGhpcy4jbD1uZXcgVGV4dEVuY29kZXIsdGhpcy4jZT1bXSx0aGlzLmFsbG9jKDEpLHRoaXMuI289cn0jZTsjdDsjbjsjczsjbDsjaTsjbzsjcjthbGxvYyh0KXtsZXQgZT1uZXcgRShuZXcgdGhpcy4jaShOdW1iZXIodCkpLCEwKSxyPXRoaXMuI3QubGVuZ3RoO3JldHVybiB0aGlzLiN0LnB1c2goZSksRS5pbmRleFRvQWRkcmVzcyhyKX1nZXRWYXJpYWJsZSh0KXtyZXR1cm4gdGhpcy4jci5oYXModCk/dGhpcy5yZWFkKHRoaXMuI3IuZ2V0KHQpKTpudWxsfXNldFZhcmlhYmxlKHQsZSl7bGV0IHI9dGhpc1tHXShlKTtpZihyPT09bnVsbClyZXR1cm4gMG47bGV0IGE9dGhpcy4jci5nZXQodCk/P251bGw7cmV0dXJuIGEhPT1udWxsJiYodGhpcy4jdFthXT10aGlzLiN0W3JdLHRoaXMuI3Rbcl09bnVsbCxyPT09dGhpcy4jdC5sZW5ndGgtMSYmdGhpcy4jdC5wb3AoKSksdGhpcy4jci5zZXQodCxhPz9yKSxFLmluZGV4VG9BZGRyZXNzKGE/P3IpfXJlYWQodCl7bGV0IGU9RS5hZGRyZXNzVG9JbmRleCh0KSxyPXRoaXMuI3RbZV07aWYoIXIpcmV0dXJuIG51bGw7bGV0IGE9IShyLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSYmIV90LmFsbG93U2hhcmVkQnVmZmVyQ29kZWM/bmV3IFVpbnQ4QXJyYXkoci5idWZmZXIpLnNsaWNlKCkuYnVmZmVyOnIuYnVmZmVyO3JldHVybiBuZXcgVChhKX1zdG9yZSh0KXtsZXQgZT10aGlzW0ddKHQpO2lmKCFlKXRocm93IG5ldyBFcnJvcigiZmFpbGVkIHRvIHN0b3JlIG91dHB1dCIpO3JldHVybiBFLmluZGV4VG9BZGRyZXNzKGUpfWxlbmd0aCh0KXtsZXQgZT1FLmFkZHJlc3NUb0luZGV4KHQpLHI9dGhpcy4jdFtlXTtyZXR1cm4gcj9CaWdJbnQoci5idWZmZXIuYnl0ZUxlbmd0aCk6MG59Z2V0I2EoKXtsZXQgdD10aGlzLiNlW3RoaXMuI2UubGVuZ3RoLTFdWzBdO3JldHVybiB0PT09bnVsbD9udWxsOnRoaXMuI3RbdF19Wyh4dD1RLEopXSgpe3RoaXMuI3QubGVuZ3RoPTEsdGhpcy4jZS5sZW5ndGg9MH1bWl0odCl7bGV0IGU9dGhpcy4jdFt0XTtpZighZSl0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgYmxvY2sgaW5kZXg6ICR7dH1gKTtyZXR1cm4gZX1bWV0odCxlPSExKXtmb3IobGV0W3IsYV1vZiB0LmJsb2Nrcyl7aWYociYmZSl7bGV0IG49bmV3IFVpbnQ4QXJyYXkobmV3IHRoaXMuI2koTnVtYmVyKHIuYnl0ZUxlbmd0aCkpKTtuLnNldChuZXcgVWludDhBcnJheShyKSkscj1uLmJ1ZmZlcn10aGlzLiN0W2FdPXI/bmV3IEUociwhMSk6bnVsbH10aGlzLiNlPXQuc3RhY2t9W3pdKCl7cmV0dXJue3N0YWNrOnRoaXMuI2Uuc2xpY2UoKSxibG9ja3M6dGhpcy4jdC5tYXAoKHQsZSk9PnQ/dC5sb2NhbD8odC5sb2NhbD0hMSxbdC5idWZmZXIsZV0pOm51bGw6W251bGwsZV0pLmZpbHRlcihCb29sZWFuKX19W0ddKHQpe2lmKCF0KXJldHVybiBudWxsO2lmKHR5cGVvZiB0PT0ic3RyaW5nIiYmKHQ9dGhpcy4jbC5lbmNvZGUodCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtpZih0LmJ1ZmZlci5jb25zdHJ1Y3Rvcj09PXRoaXMuI2kpe2xldCBuPXRoaXMuI3QubGVuZ3RoO3JldHVybiB0aGlzLiN0LnB1c2gobmV3IEUodC5idWZmZXIsITApKSxufWxldCBlPUUuYWRkcmVzc1RvSW5kZXgodGhpcy5hbGxvYyh0Lmxlbmd0aCkpLHI9dGhpcy4jdFtlXTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoci5idWZmZXIpLnNldCh0LDApLGV9cmV0dXJuIHR9W3FdKHQpe3RoaXMuI2UucHVzaChbdCxudWxsLG51bGxdKX1bVl0oKXtsZXRbLHQsZV09dGhpcy4jZS5wb3AoKSxyPWU9PT1udWxsPzE6MCxhPWU/P3Qsbj1bbnVsbCxudWxsXTtyZXR1cm4gYT09PW51bGx8fHRoaXMuI3RbYV09PT1udWxsfHwobltyXT1hKSxufX07dmFyIHk9Y2xhc3N7c3RhdGljIHJlYWRfYnl0ZXModCxlKXtsZXQgcj1uZXcgeTtyZXR1cm4gci5idWY9dC5nZXRVaW50MzIoZSwhMCksci5idWZfbGVuPXQuZ2V0VWludDMyKGUrNCwhMCkscn1zdGF0aWMgcmVhZF9ieXRlc19hcnJheSh0LGUscil7bGV0IGE9W107Zm9yKGxldCBuPTA7bjxyO24rKylhLnB1c2goeS5yZWFkX2J5dGVzKHQsZSs4Km4pKTtyZXR1cm4gYX19LEE9Y2xhc3N7c3RhdGljIHJlYWRfYnl0ZXModCxlKXtsZXQgcj1uZXcgQTtyZXR1cm4gci5idWY9dC5nZXRVaW50MzIoZSwhMCksci5idWZfbGVuPXQuZ2V0VWludDMyKGUrNCwhMCkscn1zdGF0aWMgcmVhZF9ieXRlc19hcnJheSh0LGUscil7bGV0IGE9W107Zm9yKGxldCBuPTA7bjxyO24rKylhLnB1c2goQS5yZWFkX2J5dGVzKHQsZSs4Km4pKTtyZXR1cm4gYX19LGh0PTAscHQ9MSx0dD0yO3ZhciBldD0yO3ZhciBudD00O3ZhciBidD0xPDwwLEh0PTE8PDEsVnQ9MTw8MixZdD0xPDwzLHp0PTE8PDQsTT1jbGFzc3t3cml0ZV9ieXRlcyh0LGUpe3Quc2V0VWludDgoZSx0aGlzLmZzX2ZpbGV0eXBlKSx0LnNldFVpbnQxNihlKzIsdGhpcy5mc19mbGFncywhMCksdC5zZXRCaWdVaW50NjQoZSs4LHRoaXMuZnNfcmlnaHRzX2Jhc2UsITApLHQuc2V0QmlnVWludDY0KGUrMTYsdGhpcy5mc19yaWdodHNfaW5oZXJpdGVkLCEwKX1jb25zdHJ1Y3Rvcih0LGUpe3RoaXMuZnNfcmlnaHRzX2Jhc2U9MG4sdGhpcy5mc19yaWdodHNfaW5oZXJpdGVkPTBuLHRoaXMuZnNfZmlsZXR5cGU9dCx0aGlzLmZzX2ZsYWdzPWV9fSwkdD0xPDwwLEt0PTE8PDEsanQ9MTw8MixYdD0xPDwzLE90PTE8PDAsTnQ9MTw8MSx5dD0xPDwyLEF0PTE8PDMsVz1jbGFzc3t3cml0ZV9ieXRlcyh0LGUpe3Quc2V0QmlnVWludDY0KGUsdGhpcy5kZXYsITApLHQuc2V0QmlnVWludDY0KGUrOCx0aGlzLmlubywhMCksdC5zZXRVaW50OChlKzE2LHRoaXMuZmlsZXR5cGUpLHQuc2V0QmlnVWludDY0KGUrMjQsdGhpcy5ubGluaywhMCksdC5zZXRCaWdVaW50NjQoZSszMix0aGlzLnNpemUsITApLHQuc2V0QmlnVWludDY0KGUrMzgsdGhpcy5hdGltLCEwKSx0LnNldEJpZ1VpbnQ2NChlKzQ2LHRoaXMubXRpbSwhMCksdC5zZXRCaWdVaW50NjQoZSs1Mix0aGlzLmN0aW0sITApfWNvbnN0cnVjdG9yKHQsZSl7dGhpcy5kZXY9MG4sdGhpcy5pbm89MG4sdGhpcy5ubGluaz0wbix0aGlzLmF0aW09MG4sdGhpcy5tdGltPTBuLHRoaXMuY3RpbT0wbix0aGlzLmZpbGV0eXBlPXQsdGhpcy5zaXplPWV9fTt2YXIgcXQ9MTw8MCxRdD0xPDwwO3ZhciBadD0xPDwwLEp0PTE8PDEsdGU9MTw8MCxlZT0xPDwwLG5lPTE8PDE7dmFyIEl0PWNsYXNze2VuYWJsZSh0KXt0aGlzLmxvZz1UdCh0PT09dm9pZCAwPyEwOnQsdGhpcy5wcmVmaXgpfWdldCBlbmFibGVkKCl7cmV0dXJuIHRoaXMuaXNFbmFibGVkfWNvbnN0cnVjdG9yKHQpe3RoaXMuaXNFbmFibGVkPXQsdGhpcy5wcmVmaXg9Indhc2k6Iix0aGlzLmVuYWJsZSh0KX19O2Z1bmN0aW9uIFR0KHUsdCl7cmV0dXJuIHU/Y29uc29sZS5sb2cuYmluZChjb25zb2xlLCIlYyVzIiwiY29sb3I6ICMyNjVCQTAiLHQpOigpPT57fX12YXIgbT1uZXcgSXQoITEpO3ZhciBLPWNsYXNzIGV4dGVuZHMgRXJyb3J7Y29uc3RydWN0b3IodCl7c3VwZXIoImV4aXQgd2l0aCBleGl0IGNvZGUgIit0KSx0aGlzLmNvZGU9dH19LHJ0PWNsYXNze3N0YXJ0KHQpe3RoaXMuaW5zdD10O3RyeXtyZXR1cm4gdC5leHBvcnRzLl9zdGFydCgpLDB9Y2F0Y2goZSl7aWYoZSBpbnN0YW5jZW9mIEspcmV0dXJuIGUuY29kZTt0aHJvdyBlfX1pbml0aWFsaXplKHQpe3RoaXMuaW5zdD10LHQuZXhwb3J0cy5faW5pdGlhbGl6ZSYmdC5leHBvcnRzLl9pbml0aWFsaXplKCl9Y29uc3RydWN0b3IodCxlLHIsYT17fSl7dGhpcy5hcmdzPVtdLHRoaXMuZW52PVtdLHRoaXMuZmRzPVtdLG0uZW5hYmxlKGEuZGVidWcpLHRoaXMuYXJncz10LHRoaXMuZW52PWUsdGhpcy5mZHM9cjtsZXQgbj10aGlzO3RoaXMud2FzaUltcG9ydD17YXJnc19zaXplc19nZXQocyxpKXtsZXQgbz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7by5zZXRVaW50MzIocyxuLmFyZ3MubGVuZ3RoLCEwKTtsZXQgbD0wO2ZvcihsZXQgZiBvZiBuLmFyZ3MpbCs9Zi5sZW5ndGgrMTtyZXR1cm4gby5zZXRVaW50MzIoaSxsLCEwKSxtLmxvZyhvLmdldFVpbnQzMihzLCEwKSxvLmdldFVpbnQzMihpLCEwKSksMH0sYXJnc19nZXQocyxpKXtsZXQgbz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksbD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxmPWk7Zm9yKGxldCBjPTA7YzxuLmFyZ3MubGVuZ3RoO2MrKyl7by5zZXRVaW50MzIocyxpLCEwKSxzKz00O2xldCBfPW5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShuLmFyZ3NbY10pO2wuc2V0KF8saSksby5zZXRVaW50OChpK18ubGVuZ3RoLDApLGkrPV8ubGVuZ3RoKzF9cmV0dXJuIG0uZW5hYmxlZCYmbS5sb2cobmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShsLnNsaWNlKGYsaSkpKSwwfSxlbnZpcm9uX3NpemVzX2dldChzLGkpe2xldCBvPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtvLnNldFVpbnQzMihzLG4uZW52Lmxlbmd0aCwhMCk7bGV0IGw9MDtmb3IobGV0IGYgb2Ygbi5lbnYpbCs9Zi5sZW5ndGgrMTtyZXR1cm4gby5zZXRVaW50MzIoaSxsLCEwKSxtLmxvZyhvLmdldFVpbnQzMihzLCEwKSxvLmdldFVpbnQzMihpLCEwKSksMH0sZW52aXJvbl9nZXQocyxpKXtsZXQgbz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksbD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxmPWk7Zm9yKGxldCBjPTA7YzxuLmVudi5sZW5ndGg7YysrKXtvLnNldFVpbnQzMihzLGksITApLHMrPTQ7bGV0IF89bmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKG4uZW52W2NdKTtsLnNldChfLGkpLG8uc2V0VWludDgoaStfLmxlbmd0aCwwKSxpKz1fLmxlbmd0aCsxfXJldHVybiBtLmVuYWJsZWQmJm0ubG9nKG5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUobC5zbGljZShmLGkpKSksMH0sY2xvY2tfcmVzX2dldChzLGkpe2xldCBvO3N3aXRjaChzKXtjYXNlIDE6e289NTAwMG47YnJlYWt9Y2FzZSAwOntvPTEwMDAwMDBuO2JyZWFrfWRlZmF1bHQ6cmV0dXJuIDUyfXJldHVybiBuZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcikuc2V0QmlnVWludDY0KGksbywhMCksMH0sY2xvY2tfdGltZV9nZXQocyxpLG8pe2xldCBsPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihzPT09MClsLnNldEJpZ1VpbnQ2NChvLEJpZ0ludChuZXcgRGF0ZSgpLmdldFRpbWUoKSkqMTAwMDAwMG4sITApO2Vsc2UgaWYocz09MSl7bGV0IGY7dHJ5e2Y9QmlnSW50KE1hdGgucm91bmQocGVyZm9ybWFuY2Uubm93KCkqMWU2KSl9Y2F0Y2h7Zj0wbn1sLnNldEJpZ1VpbnQ2NChvLGYsITApfWVsc2UgbC5zZXRCaWdVaW50NjQobywwbiwhMCk7cmV0dXJuIDB9LGZkX2FkdmlzZShzLGksbyxsKXtyZXR1cm4gbi5mZHNbc10hPW51bGw/bi5mZHNbc10uZmRfYWR2aXNlKGksbyxsKTo4fSxmZF9hbGxvY2F0ZShzLGksbyl7cmV0dXJuIG4uZmRzW3NdIT1udWxsP24uZmRzW3NdLmZkX2FsbG9jYXRlKGksbyk6OH0sZmRfY2xvc2Uocyl7aWYobi5mZHNbc10hPW51bGwpe2xldCBpPW4uZmRzW3NdLmZkX2Nsb3NlKCk7cmV0dXJuIG4uZmRzW3NdPXZvaWQgMCxpfWVsc2UgcmV0dXJuIDh9LGZkX2RhdGFzeW5jKHMpe3JldHVybiBuLmZkc1tzXSE9bnVsbD9uLmZkc1tzXS5mZF9kYXRhc3luYygpOjh9LGZkX2Zkc3RhdF9nZXQocyxpKXtpZihuLmZkc1tzXSE9bnVsbCl7bGV0e3JldDpvLGZkc3RhdDpsfT1uLmZkc1tzXS5mZF9mZHN0YXRfZ2V0KCk7cmV0dXJuIGw/LndyaXRlX2J5dGVzKG5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxpKSxvfWVsc2UgcmV0dXJuIDh9LGZkX2Zkc3RhdF9zZXRfZmxhZ3MocyxpKXtyZXR1cm4gbi5mZHNbc10hPW51bGw/bi5mZHNbc10uZmRfZmRzdGF0X3NldF9mbGFncyhpKTo4fSxmZF9mZHN0YXRfc2V0X3JpZ2h0cyhzLGksbyl7cmV0dXJuIG4uZmRzW3NdIT1udWxsP24uZmRzW3NdLmZkX2Zkc3RhdF9zZXRfcmlnaHRzKGksbyk6OH0sZmRfZmlsZXN0YXRfZ2V0KHMsaSl7aWYobi5mZHNbc10hPW51bGwpe2xldHtyZXQ6byxmaWxlc3RhdDpsfT1uLmZkc1tzXS5mZF9maWxlc3RhdF9nZXQoKTtyZXR1cm4gbD8ud3JpdGVfYnl0ZXMobmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLGkpLG99ZWxzZSByZXR1cm4gOH0sZmRfZmlsZXN0YXRfc2V0X3NpemUocyxpKXtyZXR1cm4gbi5mZHNbc10hPW51bGw/bi5mZHNbc10uZmRfZmlsZXN0YXRfc2V0X3NpemUoaSk6OH0sZmRfZmlsZXN0YXRfc2V0X3RpbWVzKHMsaSxvLGwpe3JldHVybiBuLmZkc1tzXSE9bnVsbD9uLmZkc1tzXS5mZF9maWxlc3RhdF9zZXRfdGltZXMoaSxvLGwpOjh9LGZkX3ByZWFkKHMsaSxvLGwsZil7bGV0IGM9bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLF89bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbc10hPW51bGwpe2xldCBoPXkucmVhZF9ieXRlc19hcnJheShjLGksbykse3JldDpkLG5yZWFkOnB9PW4uZmRzW3NdLmZkX3ByZWFkKF8saCxsKTtyZXR1cm4gYy5zZXRVaW50MzIoZixwLCEwKSxkfWVsc2UgcmV0dXJuIDh9LGZkX3ByZXN0YXRfZ2V0KHMsaSl7bGV0IG89bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3NdIT1udWxsKXtsZXR7cmV0OmwscHJlc3RhdDpmfT1uLmZkc1tzXS5mZF9wcmVzdGF0X2dldCgpO3JldHVybiBmPy53cml0ZV9ieXRlcyhvLGkpLGx9ZWxzZSByZXR1cm4gOH0sZmRfcHJlc3RhdF9kaXJfbmFtZShzLGksbyl7aWYobi5mZHNbc10hPW51bGwpe2xldHtyZXQ6bCxwcmVzdGF0X2Rpcl9uYW1lOmZ9PW4uZmRzW3NdLmZkX3ByZXN0YXRfZGlyX25hbWUoKTtyZXR1cm4gZiE9bnVsbCYmbmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcikuc2V0KGYsaSksbH1lbHNlIHJldHVybiA4fSxmZF9wd3JpdGUocyxpLG8sbCxmKXtsZXQgYz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksXz1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tzXSE9bnVsbCl7bGV0IGg9QS5yZWFkX2J5dGVzX2FycmF5KGMsaSxvKSx7cmV0OmQsbndyaXR0ZW46cH09bi5mZHNbc10uZmRfcHdyaXRlKF8saCxsKTtyZXR1cm4gYy5zZXRVaW50MzIoZixwLCEwKSxkfWVsc2UgcmV0dXJuIDh9LGZkX3JlYWQocyxpLG8sbCl7bGV0IGY9bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLGM9bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbc10hPW51bGwpe2xldCBfPXkucmVhZF9ieXRlc19hcnJheShmLGksbykse3JldDpoLG5yZWFkOmR9PW4uZmRzW3NdLmZkX3JlYWQoYyxfKTtyZXR1cm4gZi5zZXRVaW50MzIobCxkLCEwKSxofWVsc2UgcmV0dXJuIDh9LGZkX3JlYWRkaXIocyxpLG8sbCxmKXtsZXQgYz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksXz1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tzXSE9bnVsbCl7bGV0IGg9MDtmb3IoOzspe2xldHtyZXQ6ZCxkaXJlbnQ6cH09bi5mZHNbc10uZmRfcmVhZGRpcl9zaW5nbGUobCk7aWYoZCE9MClyZXR1cm4gYy5zZXRVaW50MzIoZixoLCEwKSxkO2lmKHA9PW51bGwpYnJlYWs7aWYoby1oPHAuaGVhZF9sZW5ndGgoKSl7aD1vO2JyZWFrfWxldCB3PW5ldyBBcnJheUJ1ZmZlcihwLmhlYWRfbGVuZ3RoKCkpO2lmKHAud3JpdGVfaGVhZF9ieXRlcyhuZXcgRGF0YVZpZXcodyksMCksXy5zZXQobmV3IFVpbnQ4QXJyYXkodykuc2xpY2UoMCxNYXRoLm1pbih3LmJ5dGVMZW5ndGgsby1oKSksaSksaSs9cC5oZWFkX2xlbmd0aCgpLGgrPXAuaGVhZF9sZW5ndGgoKSxvLWg8cC5uYW1lX2xlbmd0aCgpKXtoPW87YnJlYWt9cC53cml0ZV9uYW1lX2J5dGVzKF8saSxvLWgpLGkrPXAubmFtZV9sZW5ndGgoKSxoKz1wLm5hbWVfbGVuZ3RoKCksbD1wLmRfbmV4dH1yZXR1cm4gYy5zZXRVaW50MzIoZixoLCEwKSwwfWVsc2UgcmV0dXJuIDh9LGZkX3JlbnVtYmVyKHMsaSl7aWYobi5mZHNbc10hPW51bGwmJm4uZmRzW2ldIT1udWxsKXtsZXQgbz1uLmZkc1tpXS5mZF9jbG9zZSgpO3JldHVybiBvIT0wP286KG4uZmRzW2ldPW4uZmRzW3NdLG4uZmRzW3NdPXZvaWQgMCwwKX1lbHNlIHJldHVybiA4fSxmZF9zZWVrKHMsaSxvLGwpe2xldCBmPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tzXSE9bnVsbCl7bGV0e3JldDpjLG9mZnNldDpffT1uLmZkc1tzXS5mZF9zZWVrKGksbyk7cmV0dXJuIGYuc2V0QmlnSW50NjQobCxfLCEwKSxjfWVsc2UgcmV0dXJuIDh9LGZkX3N5bmMocyl7cmV0dXJuIG4uZmRzW3NdIT1udWxsP24uZmRzW3NdLmZkX3N5bmMoKTo4fSxmZF90ZWxsKHMsaSl7bGV0IG89bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3NdIT1udWxsKXtsZXR7cmV0Omwsb2Zmc2V0OmZ9PW4uZmRzW3NdLmZkX3RlbGwoKTtyZXR1cm4gby5zZXRCaWdVaW50NjQoaSxmLCEwKSxsfWVsc2UgcmV0dXJuIDh9LGZkX3dyaXRlKHMsaSxvLGwpe2xldCBmPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxjPW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3NdIT1udWxsKXtsZXQgXz1BLnJlYWRfYnl0ZXNfYXJyYXkoZixpLG8pLHtyZXQ6aCxud3JpdHRlbjpkfT1uLmZkc1tzXS5mZF93cml0ZShjLF8pO3JldHVybiBmLnNldFVpbnQzMihsLGQsITApLGh9ZWxzZSByZXR1cm4gOH0scGF0aF9jcmVhdGVfZGlyZWN0b3J5KHMsaSxvKXtsZXQgbD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tzXSE9bnVsbCl7bGV0IGY9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShsLnNsaWNlKGksaStvKSk7cmV0dXJuIG4uZmRzW3NdLnBhdGhfY3JlYXRlX2RpcmVjdG9yeShmKX19LHBhdGhfZmlsZXN0YXRfZ2V0KHMsaSxvLGwsZil7bGV0IGM9bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLF89bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbc10hPW51bGwpe2xldCBoPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoXy5zbGljZShvLG8rbCkpLHtyZXQ6ZCxmaWxlc3RhdDpwfT1uLmZkc1tzXS5wYXRoX2ZpbGVzdGF0X2dldChpLGgpO3JldHVybiBwPy53cml0ZV9ieXRlcyhjLGYpLGR9ZWxzZSByZXR1cm4gOH0scGF0aF9maWxlc3RhdF9zZXRfdGltZXMocyxpLG8sbCxmLGMsXyl7bGV0IGg9bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbc10hPW51bGwpe2xldCBkPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoaC5zbGljZShvLG8rbCkpO3JldHVybiBuLmZkc1tzXS5wYXRoX2ZpbGVzdGF0X3NldF90aW1lcyhpLGQsZixjLF8pfWVsc2UgcmV0dXJuIDh9LHBhdGhfbGluayhzLGksbyxsLGYsYyxfKXtsZXQgaD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tzXSE9bnVsbCYmbi5mZHNbZl0hPW51bGwpe2xldCBkPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoaC5zbGljZShvLG8rbCkpLHA9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShoLnNsaWNlKGMsYytfKSk7cmV0dXJuIG4uZmRzW2ZdLnBhdGhfbGluayhzLGksZCxwKX1lbHNlIHJldHVybiA4fSxwYXRoX29wZW4ocyxpLG8sbCxmLGMsXyxoLGQpe2xldCBwPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSx3PW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3NdIT1udWxsKXtsZXQgUj1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKHcuc2xpY2UobyxvK2wpKTttLmxvZyhSKTtsZXR7cmV0OkYsZmRfb2JqOmx0fT1uLmZkc1tzXS5wYXRoX29wZW4oaSxSLGYsYyxfLGgpO2lmKEYhPTApcmV0dXJuIEY7bi5mZHMucHVzaChsdCk7bGV0IHY9bi5mZHMubGVuZ3RoLTE7cmV0dXJuIHAuc2V0VWludDMyKGQsdiwhMCksMH1lbHNlIHJldHVybiA4fSxwYXRoX3JlYWRsaW5rKHMsaSxvLGwsZixjKXtsZXQgXz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksaD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tzXSE9bnVsbCl7bGV0IGQ9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShoLnNsaWNlKGksaStvKSk7bS5sb2coZCk7bGV0e3JldDpwLGRhdGE6d309bi5mZHNbc10ucGF0aF9yZWFkbGluayhkKTtpZih3IT1udWxsKXtsZXQgUj1uZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUodyk7aWYoUi5sZW5ndGg+ZilyZXR1cm4gXy5zZXRVaW50MzIoYywwLCEwKSw4O2guc2V0KFIsbCksXy5zZXRVaW50MzIoYyxSLmxlbmd0aCwhMCl9cmV0dXJuIHB9ZWxzZSByZXR1cm4gOH0scGF0aF9yZW1vdmVfZGlyZWN0b3J5KHMsaSxvKXtsZXQgbD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tzXSE9bnVsbCl7bGV0IGY9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShsLnNsaWNlKGksaStvKSk7cmV0dXJuIG4uZmRzW3NdLnBhdGhfcmVtb3ZlX2RpcmVjdG9yeShmKX1lbHNlIHJldHVybiA4fSxwYXRoX3JlbmFtZShzLGksbyxsLGYsYyl7dGhyb3ciRklYTUUgd2hhdCBpcyB0aGUgYmVzdCBhYnN0cmFjdGlvbiBmb3IgdGhpcz8ifSxwYXRoX3N5bWxpbmsocyxpLG8sbCxmKXtsZXQgYz1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tvXSE9bnVsbCl7bGV0IF89bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShjLnNsaWNlKHMscytpKSksaD1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGMuc2xpY2UobCxsK2YpKTtyZXR1cm4gbi5mZHNbb10ucGF0aF9zeW1saW5rKF8saCl9ZWxzZSByZXR1cm4gOH0scGF0aF91bmxpbmtfZmlsZShzLGksbyl7bGV0IGw9bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbc10hPW51bGwpe2xldCBmPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUobC5zbGljZShpLGkrbykpO3JldHVybiBuLmZkc1tzXS5wYXRoX3VubGlua19maWxlKGYpfWVsc2UgcmV0dXJuIDh9LHBvbGxfb25lb2ZmKHMsaSxvKXt0aHJvdyJhc3luYyBpbyBub3Qgc3VwcG9ydGVkIn0scHJvY19leGl0KHMpe3Rocm93IG5ldyBLKHMpfSxwcm9jX3JhaXNlKHMpe3Rocm93InJhaXNlZCBzaWduYWwgIitzfSxzY2hlZF95aWVsZCgpe30scmFuZG9tX2dldChzLGkpe2xldCBvPW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2ZvcihsZXQgbD0wO2w8aTtsKyspb1tzK2xdPU1hdGgucmFuZG9tKCkqMjU2fDB9LHNvY2tfcmVjdihzLGksbyl7dGhyb3cic29ja2V0cyBub3Qgc3VwcG9ydGVkIn0sc29ja19zZW5kKHMsaSxvKXt0aHJvdyJzb2NrZXRzIG5vdCBzdXBwb3J0ZWQifSxzb2NrX3NodXRkb3duKHMsaSl7dGhyb3cic29ja2V0cyBub3Qgc3VwcG9ydGVkIn0sc29ja19hY2NlcHQocyxpKXt0aHJvdyJzb2NrZXRzIG5vdCBzdXBwb3J0ZWQifX19fTt2YXIgTD1jbGFzc3tmZF9hZHZpc2UodCxlLHIpe3JldHVybiA1OH1mZF9hbGxvY2F0ZSh0LGUpe3JldHVybiA1OH1mZF9jbG9zZSgpe3JldHVybiAwfWZkX2RhdGFzeW5jKCl7cmV0dXJuIDU4fWZkX2Zkc3RhdF9nZXQoKXtyZXR1cm57cmV0OjU4LGZkc3RhdDpudWxsfX1mZF9mZHN0YXRfc2V0X2ZsYWdzKHQpe3JldHVybiA1OH1mZF9mZHN0YXRfc2V0X3JpZ2h0cyh0LGUpe3JldHVybiA1OH1mZF9maWxlc3RhdF9nZXQoKXtyZXR1cm57cmV0OjU4LGZpbGVzdGF0Om51bGx9fWZkX2ZpbGVzdGF0X3NldF9zaXplKHQpe3JldHVybiA1OH1mZF9maWxlc3RhdF9zZXRfdGltZXModCxlLHIpe3JldHVybiA1OH1mZF9wcmVhZCh0LGUscil7cmV0dXJue3JldDo1OCxucmVhZDowfX1mZF9wcmVzdGF0X2dldCgpe3JldHVybntyZXQ6NTgscHJlc3RhdDpudWxsfX1mZF9wcmVzdGF0X2Rpcl9uYW1lKCl7cmV0dXJue3JldDo1OCxwcmVzdGF0X2Rpcl9uYW1lOm51bGx9fWZkX3B3cml0ZSh0LGUscil7cmV0dXJue3JldDo1OCxud3JpdHRlbjowfX1mZF9yZWFkKHQsZSl7cmV0dXJue3JldDo1OCxucmVhZDowfX1mZF9yZWFkZGlyX3NpbmdsZSh0KXtyZXR1cm57cmV0OjU4LGRpcmVudDpudWxsfX1mZF9zZWVrKHQsZSl7cmV0dXJue3JldDo1OCxvZmZzZXQ6MG59fWZkX3N5bmMoKXtyZXR1cm4gMH1mZF90ZWxsKCl7cmV0dXJue3JldDo1OCxvZmZzZXQ6MG59fWZkX3dyaXRlKHQsZSl7cmV0dXJue3JldDo1OCxud3JpdHRlbjowfX1wYXRoX2NyZWF0ZV9kaXJlY3RvcnkodCl7cmV0dXJuIDU4fXBhdGhfZmlsZXN0YXRfZ2V0KHQsZSl7cmV0dXJue3JldDo1OCxmaWxlc3RhdDpudWxsfX1wYXRoX2ZpbGVzdGF0X3NldF90aW1lcyh0LGUscixhLG4pe3JldHVybiA1OH1wYXRoX2xpbmsodCxlLHIsYSl7cmV0dXJuIDU4fXBhdGhfb3Blbih0LGUscixhLG4scyl7cmV0dXJue3JldDo1OCxmZF9vYmo6bnVsbH19cGF0aF9yZWFkbGluayh0KXtyZXR1cm57cmV0OjU4LGRhdGE6bnVsbH19cGF0aF9yZW1vdmVfZGlyZWN0b3J5KHQpe3JldHVybiA1OH1wYXRoX3JlbmFtZSh0LGUscil7cmV0dXJuIDU4fXBhdGhfc3ltbGluayh0LGUpe3JldHVybiA1OH1wYXRoX3VubGlua19maWxlKHQpe3JldHVybiA1OH19O3ZhciBJPWNsYXNzIGV4dGVuZHMgTHtmZF9mZHN0YXRfZ2V0KCl7cmV0dXJue3JldDowLGZkc3RhdDpuZXcgTShudCwwKX19ZmRfcmVhZCh0LGUpe2xldCByPTA7Zm9yKGxldCBhIG9mIGUpaWYodGhpcy5maWxlX3Bvczx0aGlzLmZpbGUuZGF0YS5ieXRlTGVuZ3RoKXtsZXQgbj10aGlzLmZpbGUuZGF0YS5zbGljZShOdW1iZXIodGhpcy5maWxlX3BvcyksTnVtYmVyKHRoaXMuZmlsZV9wb3MrQmlnSW50KGEuYnVmX2xlbikpKTt0LnNldChuLGEuYnVmKSx0aGlzLmZpbGVfcG9zKz1CaWdJbnQobi5sZW5ndGgpLHIrPW4ubGVuZ3RofWVsc2UgYnJlYWs7cmV0dXJue3JldDowLG5yZWFkOnJ9fWZkX3ByZWFkKHQsZSxyKXtsZXQgYT0wO2ZvcihsZXQgbiBvZiBlKWlmKHI8dGhpcy5maWxlLmRhdGEuYnl0ZUxlbmd0aCl7bGV0IHM9dGhpcy5maWxlLmRhdGEuc2xpY2UoTnVtYmVyKHIpLE51bWJlcihyK0JpZ0ludChuLmJ1Zl9sZW4pKSk7dC5zZXQocyxuLmJ1Zikscis9QmlnSW50KHMubGVuZ3RoKSxhKz1zLmxlbmd0aH1lbHNlIGJyZWFrO3JldHVybntyZXQ6MCxucmVhZDphfX1mZF9zZWVrKHQsZSl7bGV0IHI7c3dpdGNoKGUpe2Nhc2UgaHQ6cj10O2JyZWFrO2Nhc2UgcHQ6cj10aGlzLmZpbGVfcG9zK3Q7YnJlYWs7Y2FzZSB0dDpyPUJpZ0ludCh0aGlzLmZpbGUuZGF0YS5ieXRlTGVuZ3RoKSt0O2JyZWFrO2RlZmF1bHQ6cmV0dXJue3JldDoyOCxvZmZzZXQ6MG59fXJldHVybiByPDA/e3JldDoyOCxvZmZzZXQ6MG59Oih0aGlzLmZpbGVfcG9zPXIse3JldDowLG9mZnNldDp0aGlzLmZpbGVfcG9zfSl9ZmRfdGVsbCgpe3JldHVybntyZXQ6MCxvZmZzZXQ6dGhpcy5maWxlX3Bvc319ZmRfd3JpdGUodCxlKXtsZXQgcj0wO2lmKHRoaXMuZmlsZS5yZWFkb25seSlyZXR1cm57cmV0OjgsbndyaXR0ZW46cn07Zm9yKGxldCBhIG9mIGUpe2xldCBuPXQuc2xpY2UoYS5idWYsYS5idWYrYS5idWZfbGVuKTtpZih0aGlzLmZpbGVfcG9zK0JpZ0ludChuLmJ5dGVMZW5ndGgpPnRoaXMuZmlsZS5zaXplKXtsZXQgcz10aGlzLmZpbGUuZGF0YTt0aGlzLmZpbGUuZGF0YT1uZXcgVWludDhBcnJheShOdW1iZXIodGhpcy5maWxlX3BvcytCaWdJbnQobi5ieXRlTGVuZ3RoKSkpLHRoaXMuZmlsZS5kYXRhLnNldChzKX10aGlzLmZpbGUuZGF0YS5zZXQobi5zbGljZSgwLE51bWJlcih0aGlzLmZpbGUuc2l6ZS10aGlzLmZpbGVfcG9zKSksTnVtYmVyKHRoaXMuZmlsZV9wb3MpKSx0aGlzLmZpbGVfcG9zKz1CaWdJbnQobi5ieXRlTGVuZ3RoKSxyKz1hLmJ1Zl9sZW59cmV0dXJue3JldDowLG53cml0dGVuOnJ9fWZkX3B3cml0ZSh0LGUscil7bGV0IGE9MDtpZih0aGlzLmZpbGUucmVhZG9ubHkpcmV0dXJue3JldDo4LG53cml0dGVuOmF9O2ZvcihsZXQgbiBvZiBlKXtsZXQgcz10LnNsaWNlKG4uYnVmLG4uYnVmK24uYnVmX2xlbik7aWYocitCaWdJbnQocy5ieXRlTGVuZ3RoKT50aGlzLmZpbGUuc2l6ZSl7bGV0IGk9dGhpcy5maWxlLmRhdGE7dGhpcy5maWxlLmRhdGE9bmV3IFVpbnQ4QXJyYXkoTnVtYmVyKHIrQmlnSW50KHMuYnl0ZUxlbmd0aCkpKSx0aGlzLmZpbGUuZGF0YS5zZXQoaSl9dGhpcy5maWxlLmRhdGEuc2V0KHMuc2xpY2UoMCxOdW1iZXIodGhpcy5maWxlLnNpemUtcikpLE51bWJlcihyKSkscis9QmlnSW50KHMuYnl0ZUxlbmd0aCksYSs9bi5idWZfbGVufXJldHVybntyZXQ6MCxud3JpdHRlbjphfX1mZF9maWxlc3RhdF9nZXQoKXtyZXR1cm57cmV0OjAsZmlsZXN0YXQ6dGhpcy5maWxlLnN0YXQoKX19Y29uc3RydWN0b3IodCl7c3VwZXIoKSx0aGlzLmZpbGVfcG9zPTBuLHRoaXMuZmlsZT10fX07dmFyIFM9Y2xhc3N7b3Blbih0KXtsZXQgZT1uZXcgSSh0aGlzKTtyZXR1cm4gdCZidCYmZS5mZF9zZWVrKDBuLHR0KSxlfWdldCBzaXplKCl7cmV0dXJuIEJpZ0ludCh0aGlzLmRhdGEuYnl0ZUxlbmd0aCl9c3RhdCgpe3JldHVybiBuZXcgVyhudCx0aGlzLnNpemUpfXRydW5jYXRlKCl7cmV0dXJuIHRoaXMucmVhZG9ubHk/NjM6KHRoaXMuZGF0YT1uZXcgVWludDhBcnJheShbXSksMCl9Y29uc3RydWN0b3IodCxlKXt0aGlzLmRhdGE9bmV3IFVpbnQ4QXJyYXkodCksdGhpcy5yZWFkb25seT0hIWU/LnJlYWRvbmx5fX07dmFyIE49Y2xhc3MgZXh0ZW5kcyBMe2ZkX2ZpbGVzdGF0X2dldCgpe3JldHVybntyZXQ6MCxmaWxlc3RhdDpuZXcgVyhldCxCaWdJbnQoMCkpfX1mZF9mZHN0YXRfZ2V0KCl7bGV0IHQ9bmV3IE0oZXQsMCk7cmV0dXJuIHQuZnNfcmlnaHRzX2Jhc2U9QmlnSW50KDY0KSx7cmV0OjAsZmRzdGF0OnR9fWZkX3dyaXRlKHQsZSl7bGV0IHI9MDtmb3IobGV0IGEgb2YgZSl7bGV0IG49dC5zbGljZShhLmJ1ZixhLmJ1ZithLmJ1Zl9sZW4pO3RoaXMud3JpdGUobikscis9YS5idWZfbGVufXJldHVybntyZXQ6MCxud3JpdHRlbjpyfX1zdGF0aWMgbGluZUJ1ZmZlcmVkKHQpe2xldCBlPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiLHtmYXRhbDohMX0pLHI9IiI7cmV0dXJuIG5ldyBOKGE9PntyKz1lLmRlY29kZShhLHtzdHJlYW06ITB9KTtsZXQgbj1yLnNwbGl0KGAKYCk7Zm9yKGxldFtzLGldb2Ygbi5lbnRyaWVzKCkpczxuLmxlbmd0aC0xP3QoaSk6cj1pfSl9Y29uc3RydWN0b3IodCl7c3VwZXIoKSx0aGlzLndyaXRlPXR9fTthc3luYyBmdW5jdGlvbiB3dCh1LHQsZSl7Y29uc29sZS5sb2coImZpbGVEZXNjcmlwdG9ycyA9ICIsZSk7bGV0IHI9W10sYT1bXSxuPXQ/W04ubGluZUJ1ZmZlcmVkKGk9PmNvbnNvbGUubG9nKGkpKSxOLmxpbmVCdWZmZXJlZChpPT5jb25zb2xlLmxvZyhpKSksTi5saW5lQnVmZmVyZWQoaT0+Y29uc29sZS53YXJuKGkpKSwuLi5lXTpbbmV3IEkobmV3IFMoW10pKSxuZXcgSShuZXcgUyhbXSkpLG5ldyBJKG5ldyBTKFtdKSksLi4uZV0scz1uZXcgcnQocixhLG4se2RlYnVnOiExfSk7cmV0dXJue2FzeW5jIGltcG9ydE9iamVjdCgpe3JldHVybiBzLndhc2lJbXBvcnR9LGFzeW5jIGNsb3NlKCl7fSxhc3luYyBpbml0aWFsaXplKGkpe2xldCBvPWkuZXhwb3J0cy5tZW1vcnk7aWYoIW8pdGhyb3cgbmV3IEVycm9yKCJUaGUgbW9kdWxlIGhhcyB0byBleHBvcnQgYSBkZWZhdWx0IG1lbW9yeS4iKTtpZihpLmV4cG9ydHMuX2luaXRpYWxpemUpe2xldCBsPWkuZXhwb3J0cy5faW5pdGlhbGl6ZTtzLmluaXRpYWxpemU/cy5pbml0aWFsaXplKHtleHBvcnRzOnttZW1vcnk6byxfaW5pdGlhbGl6ZTooKT0+e2woKX19fSk6bCgpfWVsc2Ugcy5zdGFydCh7ZXhwb3J0czp7bWVtb3J5Om8sX3N0YXJ0OigpPT57fX19KX19fXZhciBMdD0iZXh0aXNtOmhvc3QvZW52IixpdD1jbGFzc3sjZTsjdDsjbj0hMTsjcztjb25zdHJ1Y3Rvcih0LGUscil7dGhpcy4jZT10LHRoaXMuI3Q9ZSx0aGlzLiNzPXJ9YXN5bmMgcmVzZXQoKXtyZXR1cm4gdGhpcy5pc0FjdGl2ZSgpPyExOih0aGlzLiNlW0pdKCksITApfWlzQWN0aXZlKCl7cmV0dXJuIHRoaXMuI259YXN5bmMgZnVuY3Rpb25FeGlzdHModCl7cmV0dXJuIHR5cGVvZiB0aGlzLiN0WzFdLmV4cG9ydHNbdF09PSJmdW5jdGlvbiJ9YXN5bmMgY2FsbEJsb2NrKHQsZSl7dGhpcy4jbj0hMDtsZXQgcj10aGlzLiN0WzFdLmV4cG9ydHNbdF07aWYoIXIpdGhyb3cgRXJyb3IoYFBsdWdpbiBlcnJvcjogZnVuY3Rpb24gIiR7dH0iIGRvZXMgbm90IGV4aXN0YCk7aWYodHlwZW9mIHIhPSJmdW5jdGlvbiIpdGhyb3cgRXJyb3IoYFBsdWdpbiBlcnJvcjogZXhwb3J0ICIke3R9IiBpcyBub3QgYSBmdW5jdGlvbmApO3RoaXMuI2VbcV0oZT8/bnVsbCk7dHJ5e3JldHVybiByKCksdGhpcy4jZVtWXSgpfWNhdGNoKGEpe3Rocm93IHRoaXMuI2VbVl0oKSxhfWZpbmFsbHl7dGhpcy4jbj0hMX19YXN5bmMgY2FsbCh0LGUpe2xldCByPXRoaXMuI2VbR10oZSksW2Esbl09YXdhaXQgdGhpcy5jYWxsQmxvY2sodCxyKSxzPWEhPT1udWxsLGk9YT8/bjtpZihpPT09bnVsbClyZXR1cm4gbnVsbDtsZXQgbz10aGlzLiNlW1pdKGkpO2lmKCFvKXJldHVybiBudWxsO2xldCBsPW5ldyBUKG8uYnVmZmVyKTtpZihzKXRocm93IG5ldyBFcnJvcihgUGx1Z2luLW9yaWdpbmF0ZWQgZXJyb3I6ICR7bC5zdHJpbmcoKX1gKTtyZXR1cm4gbH1hc3luYyBnZXRFeHBvcnRzKCl7cmV0dXJuIFdlYkFzc2VtYmx5Lk1vZHVsZS5leHBvcnRzKHRoaXMuI3RbMF0pfHxbXX1hc3luYyBnZXRJbXBvcnRzKCl7cmV0dXJuIFdlYkFzc2VtYmx5Lk1vZHVsZS5pbXBvcnRzKHRoaXMuI3RbMF0pfHxbXX1hc3luYyBnZXRJbnN0YW5jZSgpe3JldHVybiB0aGlzLiN0WzFdfWFzeW5jIGNsb3NlKCl7YXdhaXQgUHJvbWlzZS5hbGwodGhpcy4jcy5tYXAodD0+dC5jbG9zZSgpKSksdGhpcy4jcy5sZW5ndGg9MH19O2FzeW5jIGZ1bmN0aW9uIG10KHUsdCxlLHI9bmV3IEQoQXJyYXlCdWZmZXIsdS5sb2dnZXIsdS5jb25maWcpKXtsZXQgYT17W0x0XTpyW1FdLGVudjp7fX07Zm9yKGxldCBsIGluIHUuZnVuY3Rpb25zKXthW2xdPWFbbF18fHt9O2ZvcihsZXQgZiBpbiB1LmZ1bmN0aW9uc1tsXSlhW2xdW2ZdPXUuZnVuY3Rpb25zW2xdW2ZdLmJpbmQobnVsbCxyKX1sZXQgbj10LmluZGV4T2YoIm1haW4iKTtpZihuPT09LTEpdGhyb3cgbmV3IEVycm9yKCdVbnJlYWNoYWJsZTogbWFuaWZlc3RzIG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUgIm1haW4iIG1vZHVsZS4gRW5mb3JjZWQgYnkgInNyYy9tYW5pZmVzdC50cyIpJyk7bGV0IHM9bmV3IE1hcCxpPVtdLG89YXdhaXQgb3QoWyJtYWluIl0sZVtuXSxhLHUsaSx0LGUscyk7cmV0dXJuIG5ldyBpdChyLFtlW25dLG9dLGkpfWFzeW5jIGZ1bmN0aW9uIG90KHUsdCxlLHIsYSxuLHMsaSl7aS5zZXQodCxudWxsKTtsZXQgbz17fSxsPVdlYkFzc2VtYmx5Lk1vZHVsZS5pbXBvcnRzKHQpLGY9bnVsbDtmb3IobGV0e2tpbmQ6aCxtb2R1bGU6ZCxuYW1lOnB9b2YgbCl7bGV0IHc9bi5pbmRleE9mKGQpO2lmKHc9PT0tMSl7aWYoZD09PSJ3YXNpX3NuYXBzaG90X3ByZXZpZXcxIiYmZj09PW51bGwpe2lmKCFyLndhc2lFbmFibGVkKXRocm93IG5ldyBFcnJvcignV0FTSSBpcyBub3QgZW5hYmxlZDsgc2VlIHRoZSAid2FzaUVuYWJsZWQiIHBsdWdpbiBvcHRpb24nKTtmPT09bnVsbCYmKGY9YXdhaXQgd3Qoci5hbGxvd2VkUGF0aHMsci5lbmFibGVXYXNpT3V0cHV0LHIuZmlsZURlc2NyaXB0b3JzKSxhLnB1c2goZiksZS53YXNpX3NuYXBzaG90X3ByZXZpZXcxPWF3YWl0IGYuaW1wb3J0T2JqZWN0KCkpfWlmKCFPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLGQpKXRocm93IG5ldyBFcnJvcihgZnJvbSBtb2R1bGUgIiR7dS5qb2luKCciLyInKX0iOiBjYW5ub3QgcmVzb2x2ZSBpbXBvcnQgIiR7ZH0iICIke3B9Ijogbm90IHByb3ZpZGVkIGJ5IGhvc3QgaW1wb3J0cyBub3IgbGlua2VkIG1hbmlmZXN0IGl0ZW1zYCk7aWYoIU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGVbZF0scCkpdGhyb3cgbmV3IEVycm9yKGBmcm9tIG1vZHVsZSAiJHt1LmpvaW4oJyIvIicpfSI6IGNhbm5vdCByZXNvbHZlIGltcG9ydCAiJHtkfSIgIiR7cH0iICgiJHtkfSIgaXMgYSBob3N0IG1vZHVsZSwgYnV0IGRvZXMgbm90IGNvbnRhaW4gIiR7cH0iKWApO3N3aXRjaChoKXtjYXNlImZ1bmN0aW9uIjp7b1tkXT8/PXt9LG9bZF1bcF09ZVtkXVtwXTticmVha31kZWZhdWx0OnRocm93IG5ldyBFcnJvcihgZnJvbSBtb2R1bGUgIiR7dS5qb2luKCciLyInKX0iOiBpbiBpbXBvcnQgIiR7ZH0iICIke3B9IiwgIiR7aH0iLXR5cGVkIGhvc3QgaW1wb3J0cyBhcmUgbm90IHN1cHBvcnRlZCB5ZXRgKX19ZWxzZXtsZXQgUj1zW3ddLEY9V2ViQXNzZW1ibHkuTW9kdWxlLmV4cG9ydHMoUik7aWYoIUYuZmluZChPPT5PLm5hbWU9PT1wJiZPLmtpbmQ9PT1oKSl0aHJvdyBuZXcgRXJyb3IoYGZyb20gbW9kdWxlICIke3Uuam9pbignIi8iJyl9IjogY2Fubm90IGltcG9ydCAiJHtkfSIgIiR7cH0iOyBubyBleHBvcnQgbWF0Y2hlZCByZXF1ZXN0YCk7bGV0IHY9Ri5maW5kKE89Pk8ubmFtZT09PSJfc3RhcnQiKT9hd2FpdCBvdChbLi4udSxkXSxSLGUscixhLG4scyxuZXcgTWFwKTooaS5oYXMoUil8fGF3YWl0IG90KFsuLi51LGRdLFIsZSxyLGEsbixzLGkpLGkuZ2V0KFIpKTtpZih2KW9bZF0/Pz17fSxvW2RdW3BdPXYuZXhwb3J0c1twXTtlbHNlIGlmKGg9PT0iZnVuY3Rpb24iKXtvW2RdPXt9O2xldCBPPW51bGw7b1tkXVtwXT0oLi4uZnQpPT57aWYoTylyZXR1cm4gTyguLi5mdCk7bGV0IGN0PWkuZ2V0KHNbd10pO2lmKCFjdCl0aHJvdyBuZXcgRXJyb3IoYGZyb20gbW9kdWxlIGluc3RhbmNlICIke3Uuam9pbignIi8iJyl9IjogdGFyZ2V0IG1vZHVsZSAiJHtkfSIgd2FzIG5ldmVyIGluc3RhbnRpYXRlZGApO3JldHVybiBPPWN0LmV4cG9ydHNbcF0sTyguLi5mdCl9fWVsc2UgdGhyb3cgbmV3IEVycm9yKGBmcm9tIG1vZHVsZSAiJHt1LmpvaW4oJyIvIicpfSI6IGNhbm5vdCBpbXBvcnQgIiR7ZH0iICIke3B9IjsgY2lyY3VsYXIgaW1wb3J0cyBvZiB0eXBlPSIke2h9IiBhcmUgbm90IHN1cHBvcnRlZGApfX1sZXQgYz1hd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZSh0LG8pLF89Yy5leHBvcnRzLmhzX2luaXQ/Imhhc2tlbGwiOmMuZXhwb3J0cy5faW5pdGlhbGl6ZT8icmVhY3RvciI6Yy5leHBvcnRzLl9zdGFydD8iY29tbWFuZCI6Im5vbmUiO2lmKGYpYXdhaXQgZj8uaW5pdGlhbGl6ZShjKSxjLmV4cG9ydHMuaHNfaW5pdCYmYy5leHBvcnRzLmhzX2luaXQoKTtlbHNlIHN3aXRjaChfKXtjYXNlImNvbW1hbmQiOmMuZXhwb3J0cy5faW5pdGlhbGl6ZSYmYy5leHBvcnRzLl9pbml0aWFsaXplKCksYy5leHBvcnRzLl9zdGFydCgpO2JyZWFrO2Nhc2UicmVhY3RvciI6Yy5leHBvcnRzLl9pbml0aWFsaXplKCk7YnJlYWs7Y2FzZSJoYXNrZWxsIjpjLmV4cG9ydHMuaHNfaW5pdCgpO2JyZWFrfXJldHVybiBpLnNldCh0LGMpLGN9dmFyIGF0PWNsYXNze2NvbnN0cnVjdG9yKHQpe2lmKCF0KXRocm93IG5ldyBFcnJvcigiVGhpcyBzaG91bGQgYmUgdW5yZWFjaGFibGU6IHRoaXMgbW9kdWxlIHNob3VsZCBvbmx5IGJlIGludm9rZWQgYXMgYSB3ZWIgd29ya2VyLiIpO3RoaXMuc2hhcmVkRGF0YT1udWxsLHRoaXMuc2hhcmVkRGF0YVZpZXc9bnVsbCx0aGlzLmhvc3RGbGFnPW51bGwsdGhpcy5wb3J0PXQsdGhpcy5wb3J0Lm9uKCJtZXNzYWdlIixlPT50aGlzLmhhbmRsZU1lc3NhZ2UoZSkpLHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZToiaW5pdGlhbGl6ZWQifSksdGhpcy5keW5hbWljSGFuZGxlcnM9bmV3IE1hcCx0aGlzLmR5bmFtaWNIYW5kbGVycy5zZXQoImNhbGwiLGFzeW5jKGUscixhLG4pPT57aWYoIXRoaXMuY29udGV4dCl0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgc3RhdGU6IG5vIGNvbnRleHQgYXZhaWxhYmxlIHRvIHdvcmtlciByZWFjdG9yIik7dGhpcy5jb250ZXh0W1ldKG4pO2xldCBzPWF3YWl0IHRoaXMucGx1Z2luPy5jYWxsQmxvY2socixhKS50aGVuKGk9PltudWxsLGldLGk9PltpLG51bGxdKTtuPXRoaXMuY29udGV4dFt6XSgpO2ZvcihsZXRbaV1vZiBuLmJsb2NrcylpJiZlLnB1c2goaSk7cmV0dXJuIHNbMF0mJihzWzBdPXtvcmlnaW5hbFN0YWNrOnNbMF0/LnN0YWNrLG1lc3NhZ2U6c1swXT8ubWVzc2FnZX0pLHtyZXN1bHRzOnMsc3RhdGU6bn19KSx0aGlzLmR5bmFtaWNIYW5kbGVycy5zZXQoInJlc2V0Iixhc3luYyBlPT50aGlzLnBsdWdpbj8ucmVzZXQoKSksdGhpcy5keW5hbWljSGFuZGxlcnMuc2V0KCJnZXRFeHBvcnRzIixhc3luYyBlPT50aGlzLnBsdWdpbj8uZ2V0RXhwb3J0cygpKSx0aGlzLmR5bmFtaWNIYW5kbGVycy5zZXQoImdldEltcG9ydHMiLGFzeW5jIGU9PnRoaXMucGx1Z2luPy5nZXRJbXBvcnRzKCkpLHRoaXMuZHluYW1pY0hhbmRsZXJzLnNldCgiZnVuY3Rpb25FeGlzdHMiLGFzeW5jKGUscik9PnRoaXMucGx1Z2luPy5mdW5jdGlvbkV4aXN0cyhyKSl9YXN5bmMgaGFuZGxlTWVzc2FnZSh0KXtzd2l0Y2godC50eXBlKXtjYXNlImluaXQiOnJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUluaXQodCk7Y2FzZSJpbnZva2UiOnJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUludm9rZSh0KX19YXN5bmMgaGFuZGxlSW52b2tlKHQpe2xldCBlPXRoaXMuZHluYW1pY0hhbmRsZXJzLmdldCh0LmhhbmRsZXIpO2lmKCFlKXJldHVybiB0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6InJldHVybiIscmVzdWx0Oltgbm8gaGFuZGxlciByZWdpc3RlcmVkIGZvciAke3QuaGFuZGxlcn1gLG51bGxdfSk7bGV0IHI9W10sYT1hd2FpdCBlKHIsLi4udC5hcmdzfHxbXSkudGhlbihuPT5bbnVsbCxuXSxuPT5bbixudWxsXSk7cmV0dXJuIGFbMF0mJihhWzBdPXtvcmlnaW5hbFN0YWNrOmFbMF0/LnN0YWNrLG1lc3NhZ2U6YVswXT8ubWVzc2FnZX0pLHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZToicmV0dXJuIixyZXN1bHRzOmF9LHIpfWFzeW5jIGhhbmRsZUluaXQodCl7dGhpcy5zaGFyZWREYXRhPXQuc2hhcmVkRGF0YSx0aGlzLnNoYXJlZERhdGFWaWV3PW5ldyBEYXRhVmlldyh0LnNoYXJlZERhdGEpLHRoaXMuaG9zdEZsYWc9bmV3IEludDMyQXJyYXkodGhpcy5zaGFyZWREYXRhKTtsZXQgZT1PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXModC5mdW5jdGlvbnMpLm1hcCgoW2wsZl0pPT5bbCxPYmplY3QuZnJvbUVudHJpZXMoZi5tYXAoYz0+W2MsKF8sLi4uaCk9PnRoaXMuY2FsbEhvc3QoXyxsLGMsaCldKSldKSkse3R5cGU6cixtb2R1bGVzOmEsZnVuY3Rpb25zOm4sLi4uc309dCxpPWw9PmY9PnRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZToibG9nIixsZXZlbDpsLG1lc3NhZ2U6Zn0pLG89T2JqZWN0LmZyb21FbnRyaWVzKFsiaW5mbyIsImRlYnVnIiwid2FybiIsImVycm9yIl0ubWFwKGw9PltsLGkobCldKSk7dGhpcy5jb250ZXh0PW5ldyBEKEFycmF5QnVmZmVyLG8sdC5jb25maWcpLHRoaXMucGx1Z2luPWF3YWl0IG10KHsuLi5zLGZ1bmN0aW9uczplLGZldGNoLGxvZ2dlcjpvfSx0Lm5hbWVzLGEsdGhpcy5jb250ZXh0KSx0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6InJlYWR5In0pfWNhbGxIb3N0KHQsZSxyLGEpe2lmKCF0aGlzLmhvc3RGbGFnKXRocm93IG5ldyBFcnJvcigiYXR0ZW1wdGVkIHRvIGNhbGwgaG9zdCBiZWZvcmUgcmVjZWl2aW5nIHNoYXJlZCBhcnJheSBidWZmZXIiKTtBdG9taWNzLnN0b3JlKHRoaXMuaG9zdEZsYWcsMCx4KTtsZXQgbj10W3pdKCk7dGhpcy5wb3J0LnBvc3RNZXNzYWdlKHt0eXBlOiJpbnZva2UiLG5hbWVzcGFjZTplLGZ1bmM6cixhcmdzOmEsc3RhdGU6bn0pO2xldCBzPW5ldyBqKHRoaXMuc2hhcmVkRGF0YSksaT1bXSxvO2Rve2xldCBsPXMucmVhZFVpbnQ4KCk7c3dpdGNoKGwpe2Nhc2UgMjU1OnJldHVybiBuLmJsb2Nrcz1pLHRbWV0obikscy5jbG9zZSgpLG87Y2FzZSAxOm89cy5yZWFkVWludDY0KCk7YnJlYWs7Y2FzZSAyOm89cy5yZWFkRmxvYXQ2NCgpO2JyZWFrO2Nhc2UgMzpvPXZvaWQgMDticmVhaztjYXNlIDQ6e2xldCBmPXMucmVhZFVpbnQzMigpLGM9cy5yZWFkVWludDMyKCk7aWYoIWMpaS5wdXNoKFtudWxsLGZdKTtlbHNle2xldCBfPW5ldyBVaW50OEFycmF5KGMpO3MucmVhZChfKSxpLnB1c2goW18uYnVmZmVyLGZdKX19YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgc2VjdGlvbiB0eXBlPSIke2x9IiBhdCBwb3NpdGlvbiAke3MucG9zaXRpb259OyBwbGVhc2Ugb3BlbiBhbiBpc3N1ZSAoaHR0cHM6Ly9naXRodWIuY29tL2V4dGlzbS9qcy1zZGsvaXNzdWVzL25ldz90aXRsZT1zaGFyZWQrYXJyYXkrYnVmZmVyK2JhZCtzZWN0aW9uK3R5cGUrJHtsfSZsYWJlbHM9YnVnKWApfX13aGlsZSgxKX19O25ldyBhdChkdCk7dmFyIFV0PTUwMCxVLGo9Y2xhc3N7Y29uc3RydWN0b3IodCl7UCh0aGlzLFUsdm9pZCAwKTt0aGlzLmlucHV0PXQsdGhpcy5pbnB1dE9mZnNldD14LHRoaXMuZmxhZz1uZXcgSW50MzJBcnJheSh0aGlzLmlucHV0KSx0aGlzLnNjcmF0Y2g9bmV3IEFycmF5QnVmZmVyKDgpLHRoaXMuc2NyYXRjaFZpZXc9bmV3IERhdGFWaWV3KHRoaXMuc2NyYXRjaCksdGhpcy5wb3NpdGlvbj0wLGsodGhpcyxVLDApLHRoaXMud2FpdCgpfWNsb3NlKCl7dGhpcy5zaWduYWwoKSxBdG9taWNzLnN0b3JlKHRoaXMuZmxhZywwLHgpfXdhaXQoKXtsZXQgdD14O2RvIHQ9QXRvbWljcy5sb2FkKHRoaXMuZmxhZywwKSx0PT09eCYmQXRvbWljcy53YWl0KHRoaXMuZmxhZywwLHgsVXQpO3doaWxlKHQ8PXgpO2sodGhpcyxVLEF0b21pY3MubG9hZCh0aGlzLmZsYWcsMCkpLHRoaXMuaW5wdXRPZmZzZXQ9eH1nZXQgYXZhaWxhYmxlKCl7cmV0dXJuIEModGhpcyxVKS10aGlzLmlucHV0T2Zmc2V0fXNpZ25hbCgpe0F0b21pY3Muc3RvcmUodGhpcy5mbGFnLDAseCksQXRvbWljcy5ub3RpZnkodGhpcy5mbGFnLDAsMSl9cHVsbCgpe3RoaXMuc2lnbmFsKCksdGhpcy53YWl0KCl9cmVhZCh0KXtpZih0aGlzLnBvc2l0aW9uKz10LmJ5dGVMZW5ndGgsdC5ieXRlTGVuZ3RoPHRoaXMuYXZhaWxhYmxlKXt0LnNldChuZXcgVWludDhBcnJheSh0aGlzLmlucHV0KS5zdWJhcnJheSh0aGlzLmlucHV0T2Zmc2V0LHRoaXMuaW5wdXRPZmZzZXQrdC5ieXRlTGVuZ3RoKSksdGhpcy5pbnB1dE9mZnNldCs9dC5ieXRlTGVuZ3RoO3JldHVybn1sZXQgZT0wLHI9dGhpcy5hdmFpbGFibGU7ZG97aWYodC5zZXQobmV3IFVpbnQ4QXJyYXkodGhpcy5pbnB1dCkuc3ViYXJyYXkodGhpcy5pbnB1dE9mZnNldCx0aGlzLmlucHV0T2Zmc2V0K3IpLGUpLGUrPXIsdGhpcy5pbnB1dE9mZnNldCs9cixlPT09dC5ieXRlTGVuZ3RofHx0aGlzLmF2YWlsYWJsZTwwKWJyZWFrO3RoaXMucHVsbCgpLHI9TWF0aC5taW4oTWF0aC5tYXgodGhpcy5hdmFpbGFibGUsMCksdC5ieXRlTGVuZ3RoLWUpfXdoaWxlKGUhPT10LmJ5dGVMZW5ndGgpfXJlYWRVaW50OCgpe3JldHVybiB0aGlzLnJlYWQobmV3IFVpbnQ4QXJyYXkodGhpcy5zY3JhdGNoKS5zdWJhcnJheSgwLDEpKSx0aGlzLnNjcmF0Y2hWaWV3LmdldFVpbnQ4KDApfXJlYWRVaW50MzIoKXtyZXR1cm4gdGhpcy5yZWFkKG5ldyBVaW50OEFycmF5KHRoaXMuc2NyYXRjaCkuc3ViYXJyYXkoMCw0KSksdGhpcy5zY3JhdGNoVmlldy5nZXRVaW50MzIoMCwhMCl9cmVhZFVpbnQ2NCgpe3JldHVybiB0aGlzLnJlYWQobmV3IFVpbnQ4QXJyYXkodGhpcy5zY3JhdGNoKSksdGhpcy5zY3JhdGNoVmlldy5nZXRCaWdVaW50NjQoMCwhMCl9cmVhZEZsb2F0NjQoKXtyZXR1cm4gdGhpcy5yZWFkKG5ldyBVaW50OEFycmF5KHRoaXMuc2NyYXRjaCkpLHRoaXMuc2NyYXRjaFZpZXcuZ2V0RmxvYXQ2NCgwLCEwKX19O1U9bmV3IFdlYWtNYXAsai5TQUJfSURYPTA7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdvcmtlci5qcy5tYXAK");var he=new WeakMap,bt=class extends(globalThis.Worker||Object){constructor(t){super(t,{type:"module",credentials:"omit",name:"extism-worker",crossOriginIsolated:!0})}on(t,e){let s=i=>e(i.data);he.set(e,s),this.addEventListener(t,s)}removeListener(t,e){let s=he.get(e);s&&this.removeEventListener(t,s)}once(t,e){let s=this;this.addEventListener(t,function i(...n){s.removeEventListener(t,i),e.call(s,...n)})}};var Ye=De(Ve(),1);var pt=o=>{if(typeof o!="string")throw new TypeError("invalid pattern");if(o.length>65536)throw new TypeError("pattern is too long")};var fs={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Zt=o=>o.replace(/[[\]\\-]/g,"\\$&"),ps=o=>o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Ie=o=>o.join(""),we=(o,t)=>{let e=t;if(o.charAt(e)!=="[")throw new Error("not in a brace expression");let s=[],i=[],n=e+1,r=!1,a=!1,l=!1,c=!1,d=e,h="";t:for(;n<o.length;){let u=o.charAt(n);if((u==="!"||u==="^")&&n===e+1){c=!0,n++;continue}if(u==="]"&&r&&!l){d=n+1;break}if(r=!0,u==="\\"&&!l){l=!0,n++;continue}if(u==="["&&!l){for(let[y,[Z,w,F]]of Object.entries(fs))if(o.startsWith(y,n)){if(h)return["$.",!1,o.length-e,!0];n+=y.length,F?i.push(Z):s.push(Z),a=a||w;continue t}}if(l=!1,h){u>h?s.push(Zt(h)+"-"+Zt(u)):u===h&&s.push(Zt(u)),h="",n++;continue}if(o.startsWith("-]",n+1)){s.push(Zt(u+"-")),n+=2;continue}if(o.startsWith("-",n+1)){h=u,n+=2;continue}s.push(Zt(u)),n++}if(d<n)return["",!1,0,!1];if(!s.length&&!i.length)return["$.",!1,o.length-e,!0];if(i.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!c){let u=s[0].length===2?s[0].slice(-1):s[0];return[ps(u),!1,d-e,!1]}let m="["+(c?"^":"")+Ie(s)+"]",f="["+(c?"":"^")+Ie(i)+"]";return[s.length&&i.length?"("+m+"|"+f+")":s.length?m:f,a,d-e,!0]};var v=(o,{windowsPathsNoEscape:t=!1}={})=>t?o.replace(/\[([^\/\\])\]/g,"$1"):o.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var Zs=new Set(["!","?","+","*","@"]),Le=o=>Zs.has(o),ys="(?!(?:^|/)\\.\\.?(?:$|/))",It="(?!\\.)",Gs=new Set(["[","."]),Rs=new Set(["..","."]),Xs=new Set("().*{}+?[]^$\\!"),gs=o=>o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),vt="[^/]",Ne=vt+"*?",Se=vt+"+?",I,N,K,g,x,Q,et,D,z,st,yt,Lt,Ee,rt,wt,Gt,Ut,Nt,_e,_=class{constructor(t,e,s={}){V(this,Lt);V(this,Gt);te(this,"type");V(this,I,void 0);V(this,N,void 0);V(this,K,!1);V(this,g,[]);V(this,x,void 0);V(this,Q,void 0);V(this,et,void 0);V(this,D,!1);V(this,z,void 0);V(this,st,void 0);V(this,yt,!1);this.type=t,t&&W(this,N,!0),W(this,x,e),W(this,I,b(this,x)?b(b(this,x),I):this),W(this,z,b(this,I)===this?s:b(b(this,I),z)),W(this,et,b(this,I)===this?[]:b(b(this,I),et)),t==="!"&&!b(b(this,I),D)&&b(this,et).push(this),W(this,Q,b(this,x)?b(b(this,x),g).length:0)}get hasMagic(){if(b(this,N)!==void 0)return b(this,N);for(let t of b(this,g))if(typeof t!="string"&&(t.type||t.hasMagic))return W(this,N,!0);return b(this,N)}toString(){return b(this,st)!==void 0?b(this,st):this.type?W(this,st,this.type+"("+b(this,g).map(t=>String(t)).join("|")+")"):W(this,st,b(this,g).map(t=>String(t)).join(""))}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof _&&b(e,x)===this))throw new Error("invalid part: "+e);b(this,g).push(e)}}toJSON(){let t=this.type===null?b(this,g).slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...b(this,g).map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===b(this,I)||b(b(this,I),D)&&b(this,x)?.type==="!")&&t.push({}),t}isStart(){if(b(this,I)===this)return!0;if(!b(this,x)?.isStart())return!1;if(b(this,Q)===0)return!0;let t=b(this,x);for(let e=0;e<b(this,Q);e++){let s=b(t,g)[e];if(!(s instanceof _&&s.type==="!"))return!1}return!0}isEnd(){if(b(this,I)===this||b(this,x)?.type==="!")return!0;if(!b(this,x)?.isEnd())return!1;if(!this.type)return b(this,x)?.isEnd();let t=b(this,x)?b(b(this,x),g).length:0;return b(this,Q)===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new _(this.type,t);for(let s of b(this,g))e.copyIn(s);return e}static fromGlob(t,e={}){var i;let s=new _(null,void 0,e);return B(i=_,rt,wt).call(i,t,s,0,e),s}toMMPattern(){if(this!==b(this,I))return b(this,I).toMMPattern();let t=this.toString(),[e,s,i,n]=this.toRegExpSource();if(!(i||b(this,N)||b(this,z).nocase&&!b(this,z).nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return s;let a=(b(this,z).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${e}$`,a),{_src:e,_glob:t})}toRegExpSource(t){let e=t??!!b(this,z).dot;if(b(this,I)===this&&B(this,Lt,Ee).call(this),!this.type){let l=this.isStart()&&this.isEnd(),c=b(this,g).map(f=>{var w;let[p,u,y,Z]=typeof f=="string"?B(w=_,Nt,_e).call(w,f,b(this,N),l):f.toRegExpSource(t);return W(this,N,b(this,N)||y),W(this,K,b(this,K)||Z),p}).join(""),d="";if(this.isStart()&&typeof b(this,g)[0]=="string"&&!(b(this,g).length===1&&Rs.has(b(this,g)[0]))){let p=Gs,u=e&&p.has(c.charAt(0))||c.startsWith("\\.")&&p.has(c.charAt(2))||c.startsWith("\\.\\.")&&p.has(c.charAt(4)),y=!e&&!t&&p.has(c.charAt(0));d=u?ys:y?It:""}let h="";return this.isEnd()&&b(b(this,I),D)&&b(this,x)?.type==="!"&&(h="(?:$|\\/)"),[d+c+h,v(c),W(this,N,!!b(this,N)),b(this,K)]}let s=this.type==="*"||this.type==="+",i=this.type==="!"?"(?:(?!(?:":"(?:",n=B(this,Gt,Ut).call(this,e);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){let l=this.toString();return W(this,g,[l]),this.type=null,W(this,N,void 0),[l,v(this.toString()),!1,!1]}let r=!s||t||e||!It?"":B(this,Gt,Ut).call(this,!0);r===n&&(r=""),r&&(n=`(?:${n})(?:${r})*?`);let a="";if(this.type==="!"&&b(this,yt))a=(this.isStart()&&!e?It:"")+Se;else{let l=this.type==="!"?"))"+(this.isStart()&&!e&&!t?It:"")+Ne+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&r?")":this.type==="*"&&r?")?":`)${this.type}`;a=i+n+l}return[a,v(n),W(this,N,!!b(this,N)),b(this,K)]}},j=_;I=new WeakMap,N=new WeakMap,K=new WeakMap,g=new WeakMap,x=new WeakMap,Q=new WeakMap,et=new WeakMap,D=new WeakMap,z=new WeakMap,st=new WeakMap,yt=new WeakMap,Lt=new WeakSet,Ee=function(){if(this!==b(this,I))throw new Error("should only call on root");if(b(this,D))return this;this.toString(),W(this,D,!0);let t;for(;t=b(this,et).pop();){if(t.type!=="!")continue;let e=t,s=b(e,x);for(;s;){for(let i=b(e,Q)+1;!s.type&&i<b(s,g).length;i++)for(let n of b(t,g)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(b(s,g)[i])}e=s,s=b(e,x)}}return this},rt=new WeakSet,wt=function(t,e,s,i){var f,p;let n=!1,r=!1,a=-1,l=!1;if(e.type===null){let u=s,y="";for(;u<t.length;){let Z=t.charAt(u++);if(n||Z==="\\"){n=!n,y+=Z;continue}if(r){u===a+1?(Z==="^"||Z==="!")&&(l=!0):Z==="]"&&!(u===a+2&&l)&&(r=!1),y+=Z;continue}else if(Z==="["){r=!0,a=u,l=!1,y+=Z;continue}if(!i.noext&&Le(Z)&&t.charAt(u)==="("){e.push(y),y="";let w=new _(Z,e);u=B(f=_,rt,wt).call(f,t,w,u,i),e.push(w);continue}y+=Z}return e.push(y),u}let c=s+1,d=new _(null,e),h=[],m="";for(;c<t.length;){let u=t.charAt(c++);if(n||u==="\\"){n=!n,m+=u;continue}if(r){c===a+1?(u==="^"||u==="!")&&(l=!0):u==="]"&&!(c===a+2&&l)&&(r=!1),m+=u;continue}else if(u==="["){r=!0,a=c,l=!1,m+=u;continue}if(Le(u)&&t.charAt(c)==="("){d.push(m),m="";let y=new _(u,d);d.push(y),c=B(p=_,rt,wt).call(p,t,y,c,i);continue}if(u==="|"){d.push(m),m="",h.push(d),d=new _(null,e);continue}if(u===")")return m===""&&b(e,g).length===0&&W(e,yt,!0),d.push(m),m="",e.push(...h,d),c;m+=u}return e.type=null,W(e,N,void 0),W(e,g,[t.substring(s-1)]),c},Gt=new WeakSet,Ut=function(t){return b(this,g).map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[s,i,n,r]=e.toRegExpSource(t);return W(this,K,b(this,K)||r),s}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")},Nt=new WeakSet,_e=function(t,e,s=!1){let i=!1,n="",r=!1;for(let a=0;a<t.length;a++){let l=t.charAt(a);if(i){i=!1,n+=(Xs.has(l)?"\\":"")+l;continue}if(l==="\\"){a===t.length-1?n+="\\\\":i=!0;continue}if(l==="["){let[c,d,h,m]=we(t,a);if(h){n+=c,r=r||d,a+=h-1,e=e||m;continue}}if(l==="*"){s&&t==="*"?n+=Se:n+=Ne,e=!0;continue}if(l==="?"){n+=vt,e=!0;continue}n+=gs(l)}return[n,v(t),!!e,r]},V(j,rt),V(j,Nt);var Qt=(o,{windowsPathsNoEscape:t=!1}={})=>t?o.replace(/[?*()[\]]/g,"[$&]"):o.replace(/[?*()[\]\\]/g,"\\$&");var S=(o,t,e={})=>(pt(t),!e.nocomment&&t.charAt(0)==="#"?!1:new ot(t,e).match(o)),Ws=/^\*+([^+@!?\*\[\(]*)$/,xs=o=>t=>!t.startsWith(".")&&t.endsWith(o),Vs=o=>t=>t.endsWith(o),Is=o=>(o=o.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(o)),ws=o=>(o=o.toLowerCase(),t=>t.toLowerCase().endsWith(o)),Ls=/^\*+\.\*+$/,Ns=o=>!o.startsWith(".")&&o.includes("."),Ss=o=>o!=="."&&o!==".."&&o.includes("."),Es=/^\.\*+$/,_s=o=>o!=="."&&o!==".."&&o.startsWith("."),Cs=/^\*+$/,Fs=o=>o.length!==0&&!o.startsWith("."),Ys=o=>o.length!==0&&o!=="."&&o!=="..",ks=/^\?+([^+@!?\*\[\(]*)?$/,Ts=([o,t=""])=>{let e=ke([o]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},Hs=([o,t=""])=>{let e=Te([o]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},Os=([o,t=""])=>{let e=Te([o]);return t?s=>e(s)&&s.endsWith(t):e},Ks=([o,t=""])=>{let e=ke([o]);return t?s=>e(s)&&s.endsWith(t):e},ke=([o])=>{let t=o.length;return e=>e.length===t&&!e.startsWith(".")},Te=([o])=>{let t=o.length;return e=>e.length===t&&e!=="."&&e!==".."},He=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Ce={win32:{sep:"\\"},posix:{sep:"/"}},zs=He==="win32"?Ce.win32.sep:Ce.posix.sep;S.sep=zs;var k=Symbol("globstar **");S.GLOBSTAR=k;var Bs="[^/]",Js=Bs+"*?",Ms="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Ps="(?:(?!(?:\\/|^)\\.).)*?",As=(o,t={})=>e=>S(e,o,t);S.filter=As;var Y=(o,t={})=>Object.assign({},o,t),Us=o=>{if(!o||typeof o!="object"||!Object.keys(o).length)return S;let t=S;return Object.assign((s,i,n={})=>t(s,i,Y(o,n)),{Minimatch:class extends t.Minimatch{constructor(i,n={}){super(i,Y(o,n))}static defaults(i){return t.defaults(Y(o,i)).Minimatch}},AST:class extends t.AST{constructor(i,n,r={}){super(i,n,Y(o,r))}static fromGlob(i,n={}){return t.AST.fromGlob(i,Y(o,n))}},unescape:(s,i={})=>t.unescape(s,Y(o,i)),escape:(s,i={})=>t.escape(s,Y(o,i)),filter:(s,i={})=>t.filter(s,Y(o,i)),defaults:s=>t.defaults(Y(o,s)),makeRe:(s,i={})=>t.makeRe(s,Y(o,i)),braceExpand:(s,i={})=>t.braceExpand(s,Y(o,i)),match:(s,i,n={})=>t.match(s,i,Y(o,n)),sep:t.sep,GLOBSTAR:k})};S.defaults=Us;var Oe=(o,t={})=>(pt(o),t.nobrace||!/\{(?:(?!\{).)*\}/.test(o)?[o]:(0,Ye.default)(o));S.braceExpand=Oe;var vs=(o,t={})=>new ot(o,t).makeRe();S.makeRe=vs;var Qs=(o,t,e={})=>{let s=new ot(t,e);return o=o.filter(i=>s.match(i)),s.options.nonull&&!o.length&&o.push(t),o};S.match=Qs;var Fe=/[?*]|[+@!]\(.*?\)|\[|\]/,Ds=o=>o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ot=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){pt(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||He,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,this.globSet);let s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let i=this.globParts.map((n,r,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){let l=n[0]===""&&n[1]===""&&(n[2]==="?"||!Fe.test(n[2]))&&!Fe.test(n[3]),c=/^[a-z]:/i.test(n[0]);if(l)return[...n.slice(0,4),...n.slice(4).map(d=>this.parse(d))];if(c)return[n[0],...n.slice(1).map(d=>this.parse(d))]}return n.map(l=>this.parse(l))});if(this.debug(this.pattern,i),this.set=i.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){let r=this.set[n];r[0]===""&&r[1]===""&&this.globParts[n][2]==="?"&&typeof r[3]=="string"&&/^[a-z]:$/i.test(r[3])&&(r[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)t[s][i]==="**"&&(t[s][i]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let s=-1;for(;(s=e.indexOf("**",s+1))!==-1;){let i=s;for(;e[i+1]==="**";)i++;i!==s&&e.splice(s,i-s)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((s,i)=>{let n=s[s.length-1];return i==="**"&&n==="**"?s:i===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(i),s)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let i=1;i<t.length-1;i++){let n=t[i];i===1&&n===""&&t[0]===""||(n==="."||n==="")&&(e=!0,t.splice(i,1),i--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let s=0;for(;(s=t.indexOf("..",s+1))!==-1;){let i=t[s-1];i&&i!=="."&&i!==".."&&i!=="**"&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let i=-1;for(;(i=s.indexOf("**",i+1))!==-1;){let r=i;for(;s[r+1]==="**";)r++;r>i&&s.splice(i+1,r-i);let a=s[i+1],l=s[i+2],c=s[i+3];if(a!==".."||!l||l==="."||l===".."||!c||c==="."||c==="..")continue;e=!0,s.splice(i,1);let d=s.slice(0);d[i]="**",t.push(d),i--}if(!this.preserveMultipleSlashes){for(let r=1;r<s.length-1;r++){let a=s[r];r===1&&a===""&&s[0]===""||(a==="."||a==="")&&(e=!0,s.splice(r,1),r--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(e=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){let r=s[n-1];if(r&&r!=="."&&r!==".."&&r!=="**"){e=!0;let l=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...l),s.length===0&&s.push(""),n-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){let i=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);!i||(t[e]=i,t[s]=[])}return t.filter(e=>e.length)}partsMatch(t,e,s=!1){let i=0,n=0,r=[],a="";for(;i<t.length&&n<e.length;)if(t[i]===e[n])r.push(a==="b"?e[n]:t[i]),i++,n++;else if(s&&t[i]==="**"&&e[n]===t[i+1])r.push(t[i]),i++;else if(s&&e[n]==="**"&&t[i]===e[n+1])r.push(e[n]),n++;else if(t[i]==="*"&&e[n]&&(this.options.dot||!e[n].startsWith("."))&&e[n]!=="**"){if(a==="b")return!1;a="a",r.push(t[i]),i++,n++}else if(e[n]==="*"&&t[i]&&(this.options.dot||!t[i].startsWith("."))&&t[i]!=="**"){if(a==="a")return!1;a="b",r.push(e[n]),i++,n++}else return!1;return t.length===e.length&&r}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,s=0;for(let i=0;i<t.length&&t.charAt(i)==="!";i++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){let i=this.options;if(this.isWindows){let u=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),y=!u&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),Z=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),w=!Z&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),F=y?3:u?0:void 0,C=w?3:Z?0:void 0;if(typeof F=="number"&&typeof C=="number"){let[L,E]=[t[F],e[C]];L.toLowerCase()===E.toLowerCase()&&(e[C]=L,C>F?e=e.slice(C):F>C&&(t=t.slice(F)))}}let{optimizationLevel:n=1}=this.options;n>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var r=0,a=0,l=t.length,c=e.length;r<l&&a<c;r++,a++){this.debug("matchOne loop");var d=e[a],h=t[r];if(this.debug(e,d,h),d===!1)return!1;if(d===k){this.debug("GLOBSTAR",[e,d,h]);var m=r,f=a+1;if(f===c){for(this.debug("** at the end");r<l;r++)if(t[r]==="."||t[r]===".."||!i.dot&&t[r].charAt(0)===".")return!1;return!0}for(;m<l;){var p=t[m];if(this.debug(`
globstar while`,t,m,e,f,p),this.matchOne(t.slice(m),e.slice(f),s))return this.debug("globstar found match!",m,l,p),!0;if(p==="."||p===".."||!i.dot&&p.charAt(0)==="."){this.debug("dot detected!",t,m,e,f);break}this.debug("globstar swallow a segment, and continue"),m++}return!!(s&&(this.debug(`
>>> no match, partial?`,t,m,e,f),m===l))}let u;if(typeof d=="string"?(u=h===d,this.debug("string match",d,h,u)):(u=d.test(h),this.debug("pattern match",d,h,u)),!u)return!1}if(r===l&&a===c)return!0;if(r===l)return s;if(a===c)return r===l-1&&t[r]==="";throw new Error("wtf?")}braceExpand(){return Oe(this.pattern,this.options)}parse(t){pt(t);let e=this.options;if(t==="**")return k;if(t==="")return"";let s,i=null;(s=t.match(Cs))?i=e.dot?Ys:Fs:(s=t.match(Ws))?i=(e.nocase?e.dot?ws:Is:e.dot?Vs:xs)(s[1]):(s=t.match(ks))?i=(e.nocase?e.dot?Hs:Ts:e.dot?Os:Ks)(s):(s=t.match(Ls))?i=e.dot?Ss:Ns:(s=t.match(Es))&&(i=_s);let n=j.fromGlob(t,this.options).toMMPattern();return i?Object.assign(n,{test:i}):n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,s=e.noglobstar?Js:e.dot?Ms:Ps,i=new Set(e.nocase?["i"]:[]),n=t.map(l=>{let c=l.map(d=>{if(d instanceof RegExp)for(let h of d.flags.split(""))i.add(h);return typeof d=="string"?Ds(d):d===k?k:d._src});return c.forEach((d,h)=>{let m=c[h+1],f=c[h-1];d!==k||f===k||(f===void 0?m!==void 0&&m!==k?c[h+1]="(?:\\/|"+s+"\\/)?"+m:c[h]=s:m===void 0?c[h-1]=f+"(?:\\/|"+s+")?":m!==k&&(c[h-1]=f+"(?:\\/|\\/"+s+"\\/)"+m,c[h+1]=k))}),c.filter(d=>d!==k).join("/")}).join("|"),[r,a]=t.length>1?["(?:",")"]:["",""];n="^"+r+n+a+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let s=this.options;this.isWindows&&(t=t.split("\\").join("/"));let i=this.slashSplit(t);this.debug(this.pattern,"split",i);let n=this.set;this.debug(this.pattern,"set",n);let r=i[i.length-1];if(!r)for(let a=i.length-2;!r&&a>=0;a--)r=i[a];for(let a=0;a<n.length;a++){let l=n[a],c=i;if(s.matchBase&&l.length===1&&(c=[r]),this.matchOne(c,l,e))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(t){return S.defaults(t).Minimatch}};S.AST=j;S.Minimatch=ot;S.escape=Qt;S.unescape=v;function Ke(o,t){return S(o,t)}var js=Atomics.waitAsync||(()=>{let o=`onmessage = ev => {
    const [b, i, v] = ev.data
    const f = new Int32Array(b)
    postMessage(Atomics.wait(f, i, v));
  }`,t=new Blob([o],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new bt(e);return(i,n,r)=>{let a=new Promise(l=>{s.once("message",c=>{l(c)})});return s.postMessage([i.buffer,n,r]),{async:!0,value:a}}})(),Dt=class{constructor(t,e,s,i){this.#t=null;this.worker=t,this.sharedData=e,this.sharedDataView=new DataView(e),this.hostFlag=new Int32Array(e),this.opts=s,this.#e=i,this.hostFlag[0]=M,this.worker.on("message",n=>this.#s(n))}#e;#t;async reset(){return this.isActive()?!1:(await this.#i("reset"),this.#e[dt](),!0)}isActive(){return Boolean(this.#t)}async#s(t){switch(t?.type){case"invoke":return this.#o(t);case"return":return this.#l(t);case"log":return this.#n(t)}}#n(t){let e=this.opts.logger[t.level];typeof e!="function"?this.opts.logger?.error(`failed to find loglevel="${t.level}" on logger: message=${t.message}`):e.call(this.opts.logger,t.message)}#l(t){let e=this.#t||null;if(e===null)throw new Error('received "return" call with no corresponding request');this.#t=null;let[s,i]=e;if(!Array.isArray(t.results)||t.results.length!==2)return i(new Error('received malformed "return"'));let[n,r]=t.results;n?i(n):s(r)}async#i(t,...e){if(this.#t)throw new Error("plugin is not reentrant");let s,i,n=new Promise((r,a)=>{s=r,i=a});return this.#t=[s,i],this.worker.postMessage({type:"invoke",handler:t,args:e}),n}async functionExists(t){return await this.#i("functionExists",t)}async call(t,e){let s=this.#e[q](e),[i,n]=await this.callBlock(t,s),r=i!==null,a=i??n;if(a===null)return null;let l=this.#e[ct](a);if(l===null)return null;let c=new H(J.allowSharedBufferCodec?l.buffer:new Uint8Array(l.buffer).slice().buffer);if(r){let d=new TextDecoder().decode(c);throw new Error(`Plugin-originated error: ${d}`)}return c}async callBlock(t,e){let s=this.#e[Wt](),{results:i,state:n}=await this.#i("call",t,e,s);this.#e[gt](n,!0);let[r,a]=i;if(r)throw r;return a}async getExports(){return await this.#i("getExports")}async getImports(){return await this.#i("getImports")}async getInstance(){throw new Error("todo")}async close(){this.worker&&(this.worker.terminate(),this.worker=null)}async#o(t){let e=new St(this.sharedData),i=(this.opts.functions[t.namespace]??{})[t.func],n=setInterval(()=>{},0);try{if(!i)throw Error(`Plugin error: host function "${t.namespace}" "${t.func}" does not exist`);new Uint8Array(this.sharedData).subarray(8).fill(254),this.#e[gt](t.state,!0);let r=await i(this.#e,...t.args),{blocks:a}=this.#e[Wt](),l;for(let[c,d]of a)l=e.writeUint8(4),l&&await l,l=e.writeUint32(d),l&&await l,l=e.writeUint32(c?.byteLength||0),l&&await l,c&&(l=e.write(c),l&&await l);typeof r=="bigint"?(l=e.writeUint8(1),l&&await l,l=e.writeUint64(r),l&&await l):typeof r=="number"?(l=e.writeUint8(2),l&&await l,l=e.writeFloat64(r),l&&await l):(l=e.writeUint8(3),l&&await l),l=e.writeUint8(255),l&&await l,await e.flush()}catch(r){this.close();let[,a]=this.#t;return this.#t=null,a(r)}finally{clearInterval(n)}}},$s=500,St=class{constructor(t){this.scratch=new ArrayBuffer(8),this.scratchView=new DataView(this.scratch),this.output=t,this.outputOffset=M,this.flag=new Int32Array(this.output),this.wait(0)}async wait(t){let e=0;do if(e=Atomics.load(this.flag,0),e===t){let{value:s,async:i}=js(this.flag,0,t,$s);if(i&&await s==="timed-out")continue}while(e===t)}signal(){let t=Atomics.load(this.flag,0);for(;Atomics.compareExchange(this.flag,0,t,this.outputOffset)===t;);Atomics.notify(this.flag,0,1)}async flush(){if(this.outputOffset===M)return;let t=this.outputOffset;this.signal(),this.outputOffset=M,await this.wait(t)}async spanningWrite(t){let e=0,s=this.output.byteLength-this.outputOffset,i=1+Math.floor((t.byteLength-s)/(this.output.byteLength-M)),n=(t.byteLength-s)%(this.output.byteLength-M);do new Uint8Array(this.output).set(t.subarray(e,e+s),this.outputOffset),this.outputOffset+=s,e+=s,await this.flush(),s=this.output.byteLength-M,--i;while(i!=0);n&&this.write(t.subarray(e,e+n))}write(t){if(t.byteLength+this.outputOffset<this.output.byteLength){new Uint8Array(this.output).set(new Uint8Array(t),this.outputOffset),this.outputOffset+=t.byteLength;return}return this.spanningWrite(new Uint8Array(t))}writeUint8(t){return this.scratchView.setUint8(0,t),this.write(this.scratch.slice(0,1))}writeUint32(t){return this.scratchView.setUint32(0,t,!0),this.write(this.scratch.slice(0,4))}writeUint64(t){return this.scratchView.setBigUint64(0,t,!0),this.write(this.scratch.slice(0,8))}writeFloat64(t){return this.scratchView.setFloat64(0,t,!0),this.write(this.scratch.slice(0,8))}};St.SAB_IDX=0;var jt=class{constructor(t,e){this.fetch=t,this.allowedHosts=e,this.lastStatusCode=0}contribute(t){t[mt]??={},t[mt].http_request=(e,s,i)=>this.makeRequest(e,s,i),t[mt].http_status_code=()=>this.lastStatusCode}async makeRequest(t,e,s){let i=t.read(e);if(i===null)return 0n;let{header:n,url:r,method:a}=i.json(),l=a??"GET",c=new URL(r);if(!this.allowedHosts.some(u=>u===c.hostname||Ke(c.hostname,u)))throw new Error(`Call error: HTTP request to "${c}" is not allowed (no allowedHosts match "${c.hostname}")`);let h=s===0n||l==="GET"||l==="HEAD"?null:t.read(s)?.bytes(),m=this.fetch,f=await m(r,{headers:n,method:l,...h?{body:h.slice()}:{}});return this.lastStatusCode=f.status,t.store(new Uint8Array(await f.arrayBuffer()))}};async function ze(o,t,e){let s=new bt(ue),i=new nt(SharedArrayBuffer,o.logger,o.config);new jt(o.fetch,o.allowedHosts).contribute(o.functions),await new Promise((m,f)=>{s.on("message",function p(u){u?.type!=="initialized"&&f(new Error(`received unexpected message (type=${u?.type})`)),s.removeListener("message",p),m(null)})});let r=new SharedArrayBuffer(o.sharedArrayBufferSize);new Uint8Array(r).subarray(8).fill(254);let{fetch:a,logger:l,...c}=o,d={...c,type:"init",functions:Object.fromEntries(Object.entries(o.functions||{}).map(([m,f])=>[m,Object.keys(f)])),names:t,modules:e,sharedData:r},h=new Promise((m,f)=>{s.on("message",function p(u){u?.type!=="ready"&&f(new Error(`received unexpected message (type=${u?.type})`)),s.removeListener("message",p),m(null)})});return s.postMessage(d),await h,new Dt(s,r,o,i)}async function qs(o,t={}){if(t={...t},t.useWasi??=!1,t.enableWasiOutput??=t.useWasi?J.extismStdoutEnvVarSet:!1,t.functions=t.functions||{},t.allowedPaths??={},t.allowedHosts??=[].concat(t.allowedHosts||[]),t.logger??=console,t.config??={},t.fetch??=fetch,t.runInWorker??=!1,t.runInWorker&&!J.hasWorkerCapability)throw new Error("Cannot enable off-thread wasm; current context is not `crossOriginIsolated` (see https://mdn.io/crossOriginIsolated)");let[e,s]=await se(await Promise.resolve(o),t.fetch??fetch),i={allowedHosts:t.allowedHosts,allowedPaths:t.allowedPaths,functions:t.functions,fetch:t.fetch||fetch,wasiEnabled:t.useWasi,logger:t.logger,config:t.config,enableWasiOutput:t.enableWasiOutput,sharedArrayBufferSize:Number(t.sharedArrayBufferSize)||1<<16,fileDescriptors:t.fileDescriptors??[]};return(t.runInWorker?ze:de)(i,e,s)}var vi=qs;export{J as CAPABILITIES,qs as createPlugin,vi as default,qs as newPlugin};
//# sourceMappingURL=mod.js.map
